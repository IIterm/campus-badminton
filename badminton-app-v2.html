<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁæΩÊØõÁêÉÁªÑÂ±ÄÂ∫îÁî®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* ËÆ§ËØÅÁïåÈù¢Ê†∑Âºè */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
            padding: 40px 20px;
        }

        .auth-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .auth-title {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .auth-subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1rem;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .auth-input {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .auth-input:focus {
            outline: none;
            border-color: #4ecdc4;
        }

        .auth-btn {
            background: white;
            color: #333;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
        }

        .auth-btn:active {
            transform: translateY(0);
        }

        .auth-error {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 10px;
            display: none;
        }

        .main-content {
            display: none;
        }

        .header {
            background: white;
            color: #333;
            padding: 30px 20px;
            position: relative;
            border-bottom: 1px solid #ddd;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header-text {
            text-align: left;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .filter-section {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            min-width: 300px;
            backdrop-filter: blur(10px);
            border: 2px solid #000; /* Ê∑ªÂä†ÈªëËâ≤ËæπÊ°Ü */
        }

        .filter-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .filter-group {
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid #000; /* ‰∏∫ÊØè‰∏™Á≠õÈÄâÁªÑÊ∑ªÂä†ÈªëËâ≤ËæπÊ°Ü */
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }

        .filter-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .filter-select {
            width: 100%;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            color: #333;
        }

        .filter-select:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.5);
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .filter-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .apply-btn {
            background: #4ecdc4;
            color: white;
        }

        .apply-btn:hover {
            background: #3db8af;
        }

        .reset-btn {
            background: rgba(255, 255, 255, 0.8);
            color: #333;
            border: 1px solid #ccc;
        }

        .reset-btn:hover {
            background: rgba(255, 255, 255, 1);
            border: 1px solid #999;
        }
        
        .filter-select option {
            background: white;
            color: #333;
        }
        
        .filter-select option:checked {
            background: #4ecdc4;
            color: white;
        }
        
        .filter-select option:hover {
            background: #f0f0f0;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .empty-state p {
            font-size: 1rem;
            color: #7f8c8d;
        }

        .games-list {
            padding: 30px;
            min-height: 400px;
        }

        .game-item {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #4ecdc4;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .game-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .game-item.urgent {
            background: white;
            border-left: 5px solid #ff9800;
            box-shadow: 0 10px 20px rgba(255, 152, 0, 0.2);
            animation: pulse 2s infinite;
        }

        .game-item.urgent:hover {
            box-shadow: 0 15px 30px rgba(255, 152, 0, 0.3);
        }

        .urgent-badge {
            background: white;
            color: #ff9800;
            border: 1px solid #ff9800;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-left: 10px;
            animation: blink 1.5s infinite;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .game-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .level-badge {
            background: #4ecdc4;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .game-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-icon {
            width: 20px;
            height: 20px;
            background: #3498db;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }

        .contact-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .contact-label {
            font-weight: bold;
            color: #e74c3c;
            margin-right: 10px;
        }

        .videos-section {
            margin-top: 15px;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 10px;
        }

        .video-list {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .video-item {
            background: #e3f2fd;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9rem;
            color: #1976d2;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .video-item:hover {
            background: #bbdefb;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .video-item::before {
            content: '‚ñ∂Ô∏è';
            font-size: 0.8em;
        }

        /* ËßÜÈ¢ëÊí≠ÊîæÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .video-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            animation: fadeIn 0.3s ease;
        }

        .video-modal-content {
            position: relative;
            margin: 5% auto;
            width: 90%;
            max-width: 800px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        .video-modal-header {
            background: white;
            color: #333;
            border-bottom: 1px solid #ddd;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .video-modal-title {
            margin: 0;
            font-size: 1.2rem;
        }

        .video-modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        .video-modal-close:hover {
            background-color: rgba(255,255,255,0.2);
        }

        .video-modal-body {
            padding: 20px;
            text-align: center;
        }

        .video-placeholder {
            width: 100%;
            height: 400px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .video-placeholder-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .video-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: left;
        }

        .video-info h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }

        .video-info p {
            margin: 5px 0;
            color: #666;
        }

        .footer {
            background: #2c3e50;
            color: white;
            padding: 20px 30px;
            position: sticky;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .footer-left {
            flex: 1.5;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .footer-center {
            flex: 1.5;
            display: flex;
            justify-content: center;
        }

        .footer-right {
            flex: 1.5;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 15px 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            border-radius: 8px;
        }

        .nav-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .generate-btn.main-btn {
            background: white;
            color: #2c3e50;
            border: 1px solid #ddd;
            padding: 18px 45px;
            font-size: 1.4rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.1);
            transform: scale(1.1);
        }

        .generate-btn.main-btn:hover {
            transform: scale(1.15);
            box-shadow: 0 18px 35px rgba(255, 215, 0, 0.5);
        }

        .nav-btn {
            background: white;
            color: #333;
            border: 1px solid #ddd;
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 20px rgba(78, 205, 196, 0.4);
        }

        .history-btn {
            background: white;
            color: #333;
            border: 1px solid #ddd;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .history-btn:hover {
            box-shadow: 0 12px 20px rgba(102, 126, 234, 0.4);
        }

        /* ÂéÜÂè≤ÁêÉÂ±ÄÊ†∑Âºè */
        .history-games-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .history-game-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .history-game-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .history-game-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 15px;
            flex-shrink: 0;
            color: #333;
        }

        .history-game-info {
            flex: 1;
        }

        .history-game-title {
            font-weight: bold;
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 8px;
        }

        .history-game-details {
            margin-bottom: 8px;
        }

        .detail-row {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
            font-size: 0.9rem;
            color: #666;
        }

        .detail-icon {
            width: 16px;
            margin-right: 8px;
            text-align: center;
        }

        .settlement-info {
            color: #28a745;
            font-weight: 500;
        }

        .history-game-date {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 3px;
        }

        .history-game-status {
            color: #667eea;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .history-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            padding: 20px;
            background: white;
            border-radius: 15px;
            border: 1px solid #dee2e6;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 15px;
            flex-shrink: 0;
            color: #333;
        }

        .stat-info {
            flex: 1;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.3rem;
            color: #333;
        }

        /* Â≠¶Ê†°‰ø°ÊÅØÊ†∑Âºè */
        .school-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .school-badge {
            width: 80px;
            height: 80px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            border: 4px solid white;
        }

        .school-text h1 {
            margin: 0;
            font-size: 2.5rem;
            color: #333;
        }

        .school-text p {
            margin: 5px 0 0 0;
            font-size: 1.1rem;
            color: #7f8c8d;
        }

        /* Áî®Êà∑‰ø°ÊÅØÊ†∑Âºè */
        .user-section {
            display: flex;
            align-items: center;
            gap: 20px;
            justify-content: flex-end;
        }

        .profile-section {
            display: flex;
            align-items: center;
        }

        .profile-btn {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .profile-btn:hover {
            background: rgba(255, 255, 255, 0.4);
            border-color: rgba(255, 255, 255, 0.7);
            transform: translateY(-2px);
        }

        /* ÊéíË°åÊ¶úÊåâÈíÆÊ†∑Âºè */
        .ranking-section {
            margin-left: 15px;
        }

        .ranking-btn {
            background: white;
            color: #333;
            border: 1px solid #ddd;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .ranking-btn:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        /* Â≠¶Ê†°ËÉåÊôØÊ†∑Âºè */
        .school-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.1;
            z-index: -1;
            transition: opacity 0.5s ease;
        }

        .main-content {
            position: relative;
            z-index: 1;
        }

        /* Â≠¶Ê†°ÊêúÁ¥¢Ê†èÊ†∑Âºè */
        .school-search-container {
            margin-bottom: 20px;
        }

        .school-search-input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #4ecdc4;
            border-radius: 25px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }
        
        .school-search-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 5px 20px rgba(52, 152, 219, 0.3);
            background: white;
        }
        
        .school-search-input::placeholder {
            color: #999;
            font-style: italic;
        }
        
        .auth-input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .auth-input:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 5px 20px rgba(78, 205, 196, 0.3);
            background: white;
        }
        
        /* Êô∫ËÉΩÂ≠¶Ê†°ÊêúÁ¥¢Ê°ÜÊ†∑Âºè */
        .smart-school-search-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .smart-school-search {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .smart-school-search:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 5px 20px rgba(78, 205, 196, 0.3);
            background: white;
        }
        
        .smart-school-search::placeholder {
            color: #999;
            font-style: italic;
        }

        .generate-btn:active {
            transform: scale(0.95);
        }

        .game-item {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .game-item:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        /* Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: #e74c3c;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #4ecdc4;
        }

        .time-settings {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .time-type-selection {
            margin-bottom: 10px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            margin: 0;
        }

        .time-option-content {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background-color: #f9f9f9;
        }

        .time-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .weekday-checkboxes {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 5px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .checkbox-option:hover {
            background-color: #e8f5f4;
        }

        .checkbox-option input[type="checkbox"] {
            margin: 0;
        }

        .form-hint {
            color: #666;
            font-size: 12px;
            margin-top: 5px;
            display: block;
        }

        .video-upload {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-bottom: 15px;
            transition: border-color 0.3s ease;
        }

        .video-upload:hover {
            border-color: #4ecdc4;
        }

        .upload-btn {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .uploaded-videos {
            margin-top: 15px;
        }

        .video-preview {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .submit-btn {
            background: white;
            color: #333;
            border: 1px solid #ddd;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: transform 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: 1px solid #dc3545;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c82333;
            border-color: #bd2130;
            transform: translateY(-2px);
        }

        .level-description {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }

        /* ËØ¶ÊÉÖÈ°µÊ†∑Âºè */
        .detail-content {
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 10px;
        }

        .detail-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .detail-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .detail-section-title {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #4ecdc4;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .detail-item .detail-icon {
            width: 24px;
            height: 24px;
            background: #4ecdc4;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .detail-item .detail-label {
            font-weight: 500;
            color: #666;
            min-width: 80px;
        }

        .detail-item .detail-value {
            color: #333;
            flex: 1;
        }

        .detail-item.highlight {
            background: #e8f5e8;
            border: 1px solid #28a745;
        }

        .detail-item.highlight .detail-label,
        .detail-item.highlight .detail-value {
            color: #28a745;
            font-weight: 600;
        }

        .game-detail-section {
            margin-bottom: 25px;
        }

        .game-detail-section h3 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }

        .time-remaining {
            margin-top: 5px;
            font-size: 0.9rem;
            color: #e74c3c;
            font-weight: bold;
        }

        .status-info {
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
        }

        .status-info.urgent {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-info.ongoing {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-info.upcoming {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .detail-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .join-btn {
            background: white;
            color: #333;
            border: 1px solid #ddd;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .join-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.3);
        }

        .end-btn {
            background: white;
            color: #ff6b6b;
            border: 1px solid #ff6b6b;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .end-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .close-detail-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-detail-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .chat-btn {
            background: white;
            color: #ff6b6b;
            border: 1px solid #ff6b6b;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .delete-btn {
            background: white;
            color: #ff4757;
            border: 1px solid #ff4757;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.4);
        }

        /* ËÅäÂ§©Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .chat-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .chat-modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border: none;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .chat-header {
            background: white;
            color: #333;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            margin: 0;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .chat-close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
        }

        .chat-close-btn:hover {
            background-color: rgba(255,255,255,0.2);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .message.own {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #4ecdc4;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .message.own .message-avatar {
            background: #ff6b6b;
        }

        .message-content {
            max-width: 70%;
        }

        .message-bubble {
            background: white;
            padding: 10px 15px;
            border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            word-wrap: break-word;
        }

        .message.own .message-bubble {
            background: #ff6b6b;
            color: white;
        }

        .message-info {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .message.own .message-info {
            justify-content: flex-end;
        }

        .chat-input-area {
            padding: 20px;
            border-top: 1px solid #eee;
            background: white;
            border-radius: 0 0 15px 15px;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            border: 2px solid #eee;
            border-radius: 20px;
            padding: 10px 15px;
            font-size: 1rem;
            resize: none;
            min-height: 20px;
            max-height: 100px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .chat-input:focus {
            border-color: #ff6b6b;
        }

        .chat-send-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .chat-send-btn:hover {
            background: #ee5a52;
            transform: scale(1.05);
        }

        .chat-send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .empty-chat {
            text-align: center;
            color: #666;
            padding: 40px 20px;
        }

        .empty-chat-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .game-details {
                grid-template-columns: 1fr;
            }
            
            .game-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .time-settings {
                grid-template-columns: 1fr;
            }

            .detail-grid {
                grid-template-columns: 1fr;
            }

            .detail-actions {
                flex-direction: column;
            }

            .join-btn, .close-detail-btn {
                width: 100%;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }

        /* Â•ΩÂèãÂàóË°®Ê†∑Âºè */
        .friends-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .friend-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .friend-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #ff6b6b;
        }

        .friend-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #ff6b6b;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .friend-info {
            flex: 1;
        }

        .friend-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 5px;
        }

        .friend-school {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 3px;
        }

        .friend-rating {
            color: #ff6b6b;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .friend-action-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .friend-action-btn:hover {
            background: #ff5252;
            transform: scale(1.05);
        }

        /* ÂããÁ´†Á≥ªÁªüÊ†∑Âºè */
        .badges-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .badge-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: #f8f9fa;
            transition: all 0.3s ease;
            opacity: 0.5;
        }

        .badge-item.earned {
            border-color: #ff6b6b;
            background: white;
            opacity: 1;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.2);
        }

        .badge-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .badge-item.earned:hover {
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.3);
        }

        .badge-icon {
            font-size: 2.5rem;
            margin-right: 15px;
            filter: grayscale(100%);
            transition: filter 0.3s ease;
        }

        .badge-item.earned .badge-icon {
            filter: none;
        }

        .badge-info {
            flex: 1;
        }

        .badge-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 5px;
        }

        .badge-item.earned .badge-name {
            color: #ff6b6b;
        }

        .badge-desc {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }

        .badge-item.earned .badge-desc {
            color: #555;
        }

        /* Â§¥ÂÉèÁõ∏ÂÖ≥Ê†∑Âºè */
        .avatar-display-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .avatar-display {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid #ff6b6b;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            margin-bottom: 10px;
        }

        .avatar-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 0.9rem;
        }

        .avatar-placeholder i {
            font-size: 2.5rem;
            margin-bottom: 5px;
            color: #ddd;
        }

        .avatar-upload-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .avatar-preview {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 2px solid #ff6b6b;
            overflow: hidden;
            margin-bottom: 15px;
            display: none;
        }

        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-upload-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .avatar-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .select-avatar-btn {
            background: #ff6b6b;
            color: white;
        }

        .select-avatar-btn:hover {
            background: #ff5252;
        }

        .remove-avatar-btn {
            background: #6c757d;
            color: white;
        }

        .remove-avatar-btn:hover {
            background: #5a6268;
        }

        .avatar-upload-note {
            font-size: 0.8rem;
            color: #666;
            text-align: center;
            margin-top: 10px;
            line-height: 1.4;
        }

        #avatarInput {
            display: none;
        }
    </style>
</head>
<body>


    <!-- Â≠¶Ê†°ËÉåÊôØ -->
    <div class="school-background" id="schoolBackground"></div>
    
    <!-- ‰∏ªÂÜÖÂÆπÁïåÈù¢ -->
    <div class="main-content" id="mainContent">
        <div class="container">
            <div class="header">
            <div class="header-content">
                <!-- Ê†°ÂæΩÂíåÂ≠¶Ê†°‰ø°ÊÅØ -->
                <div class="school-info">
                    <div class="school-badge" id="schoolBadge">üè´</div>
                    <div class="school-text">
                        <h1>üè∏ ÁîüÂëΩ‰∏çÊÅØ ÁæΩÁêÉ‰∏çÊ≠¢</h1>
                        <p id="schoolWelcome">Âø´Êù•Âä†ÂÖ•ÁæΩÁêÉÂ§ßÂÆ∂Â∫≠Ôºå‰∏éÂêåÂ≠¶‰ª¨‰∏ÄËµ∑‰∫§ÊµÅÂàáÁ£ãÂêß~</p>
                    </div>
                </div>
                
                <div class="ranking-section" style="display: flex; justify-content: flex-end; margin-bottom: 20px;">
                    <button class="ranking-btn" onclick="openRankingPage()" style="background: white; color: #333; border: 1px solid #ddd; border-radius: 12px; padding: 12px 24px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        üèÜ ÊéíË°åÊ¶ú
                    </button>
                </div>
                
                <div class="filter-section">
                    <div class="filter-title">üîç Á≠õÈÄâÁêÉÂ±Ä</div>
                    
                    <div class="filter-group">
                        <label class="filter-label">‚è∞ Êó∂Èó¥Á≠õÈÄâ</label>
                        <select class="filter-select" id="timeFilter">
                            <option value="">ÂÖ®ÈÉ®Êó∂Èó¥</option>
                            <option value="Â∑•‰ΩúÊó•">Â∑•‰ΩúÊó•</option>
                            <option value="Âë®Êú´">Âë®Êú´</option>
                            <option value="Âë®‰∏Ä">Âë®‰∏Ä</option>
                            <option value="Âë®‰∫å">Âë®‰∫å</option>
                            <option value="Âë®‰∏â">Âë®‰∏â</option>
                            <option value="Âë®Âõõ">Âë®Âõõ</option>
                            <option value="Âë®‰∫î">Âë®‰∫î</option>
                            <option value="Âë®ÂÖ≠">Âë®ÂÖ≠</option>
                            <option value="Âë®Êó•">Âë®Êó•</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">üìç Âú∞ÁÇπÁ≠õÈÄâ</label>
                        <div class="location-filter-container" style="position: relative;">
                            <input type="text" class="filter-select" id="locationFilter" placeholder="ËæìÂÖ•ÊàñÈÄâÊã©Âú∞ÁÇπ" list="locationOptions">
                            <datalist id="locationOptions">
                                <option value="ÂÖ®ÈÉ®Âú∞ÁÇπ">
                                <option value="Á´πÊµ∑ÁæΩÊØõÁêÉÈ¶Ü">
                                <option value="ÂçóÊπñÁæΩÊØõÁêÉÈ¶Ü">
                                <option value="ÊñáÊòåÁæΩÊØõÁêÉÈ¶Ü">
                                <option value="ÊÅíÂä®ÁæΩÊØõÁêÉÈ¶Ü">
                            </datalist>
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">üìä Ê∞¥Âπ≥Á≠õÈÄâ</label>
                        <select class="filter-select" id="levelFilter">
                            <option value="">ÂÖ®ÈÉ®Ê∞¥Âπ≥</option>
                            <option value="1Á∫ß">1Á∫ß - ÂàùÂ≠¶ËÄÖ</option>
                            <option value="2Á∫ß">2Á∫ß - Âü∫Á°ÄÊ∞¥Âπ≥</option>
                            <option value="3Á∫ß">3Á∫ß - ‰∏≠Á∫ßÊ∞¥Âπ≥</option>
                            <option value="4Á∫ß">4Á∫ß - ‰∏≠È´òÁ∫ßÊ∞¥Âπ≥</option>
                            <option value="5Á∫ß">5Á∫ß - È´òÁ∫ßÊ∞¥Âπ≥</option>
                            <option value="6Á∫ß">6Á∫ß - ‰∏ì‰∏öÊ∞¥Âπ≥</option>
                        </select>
                    </div>
                    
                    <div class="filter-actions">
                        <button type="button" class="filter-btn apply-btn" onclick="applyFilters()">Â∫îÁî®Á≠õÈÄâ</button>
                        <button type="button" class="filter-btn reset-btn" onclick="resetFilters()">ÈáçÁΩÆÁ≠õÈÄâ</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="games-list" id="gamesList">
            <!-- ÁêÉÂ±ÄÂàóË°®Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
        </div>
        
        <div class="footer">
            <div class="footer-left">
                <div class="nav-item" onclick="showMainPage();">
                    üè† È¶ñÈ°µ
                </div>
                <div class="nav-item" onclick="openHistoryModal();">
                    üìö ÂéÜÂè≤ÁêÉÂ±Ä
                </div>
            </div>
            <div class="footer-center">
                <button type="button" class="generate-btn main-btn" onclick="openCreateModal();">
                    üè∏ ‰∏ÄÈîÆÁîüÊàêÊñ∞ÁêÉÂ±Ä
                </button>
            </div>
            <div class="footer-right">
                <div class="nav-item" onclick="openFriendsModal();">
                    üë• Â•ΩÂèã
                </div>
                <div class="nav-item" onclick="openPersonalInfoModal();">
                    üë§ ‰∏™‰∫∫‰ø°ÊÅØ
                </div>
            </div>
        </div>
    </div>

    <!-- ÁêÉÂ±ÄËØ¶ÊÉÖÈ°µÊ®°ÊÄÅÊ°Ü -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="detailTitle">ÁêÉÂ±ÄËØ¶ÊÉÖ</h2>
                <button class="close-btn" onclick="closeDetailModal()">&times;</button>
            </div>
            
            <div class="detail-content">
                <!-- Â§¥ÂÉèÊòæÁ§∫Âå∫Âüü -->
                <div class="detail-section">
                    <h3 class="detail-section-title">Â§¥ÂÉè</h3>
                    <div class="avatar-display-container">
                        <div class="avatar-display" id="avatarDisplay">
                            <img id="avatarImage" src="" alt="Áî®Êà∑Â§¥ÂÉè" style="display: none;">
                            <div class="avatar-placeholder" id="avatarPlaceholder">
                                <div class="avatar-icon">üë§</div>
                                <div class="avatar-text">ÊöÇÊó†Â§¥ÂÉè</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h3 class="detail-section-title">Âü∫Êú¨‰ø°ÊÅØ</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-icon">üè∏</div>
                            <div>
                                <strong>ÁêÉÂ±ÄÊ†áÈ¢ò:</strong>
                                <span id="detailGameTitle"></span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üìä</div>
                            <div>
                                <strong>Ê∞¥Âπ≥Á≠âÁ∫ß:</strong>
                                <span id="detailLevel" class="level-badge"></span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">‚è∞</div>
                            <div>
                                <strong>Êó∂Èó¥:</strong>
                                <span id="detailTime"></span>
                                <div id="detailTimeRemaining" class="time-remaining"></div>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üìç</div>
                            <div>
                                <strong>Âú∞ÁÇπ:</strong>
                                <span id="detailLocation"></span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üë•</div>
                            <div>
                                <strong>ÂèÇ‰∏é‰∫∫Êï∞:</strong>
                                <span id="detailPlayers"></span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üè∏</div>
                            <div>
                                <strong>ÁæΩÊØõÁêÉ‰ø°ÊÅØ:</strong>
                                <div style="display: flex; gap: 20px; margin-top: 5px;">
                                    <span><strong>ÂêçÁß∞:</strong> <span id="detailShuttlecockName"></span></span>
                                    <span><strong>‰ª∑Ê†º:</strong> <span id="detailShuttlecockPrice"></span>ÂÖÉ</span>
                                </div>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üë§</div>
                            <div>
                                <strong>ÁªÑÂ±Ä‰∫∫:</strong>
                                <span id="detailOrganizerName"></span>
                                <div id="detailOrganizerRating" style="color: #ffa726; font-size: 0.9em;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3 class="detail-section-title">ÂèÇËÄÉËßÜÈ¢ë</h3>
                    <div id="detailVideos" class="video-list"></div>
                </div>

                <div class="detail-section">
                    <h3 class="detail-section-title">ËÅîÁ≥ªÊñπÂºè</h3>
                    <div class="contact-info">
                        <span class="contact-label">üìû ËÅîÁ≥ªÊñπÂºè:</span>
                        <span id="detailContact"></span>
                    </div>
                </div>

                <div class="detail-section">
                    <h3 class="detail-section-title">ÁêÉÂ±ÄÁä∂ÊÄÅ</h3>
                    <div id="detailStatus" class="status-info"></div>
                </div>
            </div>

            <div class="detail-actions">
                <button id="joinGameBtn" class="join-btn" onclick="joinGame()">Âä†ÂÖ•ÁêÉÂ±Ä</button>
                <button id="endGameBtn" class="end-btn" onclick="endGame()" style="display: none;">üèÅ ÁªìÊùüÁêÉÂ±Ä</button>
                <button class="chat-btn" onclick="openChatModal()">üí¨ ËÅäÂ§©</button>
                <button id="deleteGameBtn" class="delete-btn" onclick="deleteGame()" style="display: none;">üóëÔ∏è Âà†Èô§ÁêÉÂ±Ä</button>
                <button class="close-detail-btn" onclick="closeDetailModal()">ÂÖ≥Èó≠</button>
            </div>
        </div>
    </div>

    <!-- ÂàõÂª∫ÁêÉÂ±ÄÊ®°ÊÄÅÊ°Ü -->
    <div id="createModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ÂàõÂª∫Êñ∞ÁêÉÂ±Ä</h2>
                <button class="close-btn" onclick="closeCreateModal()">&times;</button>
            </div>
            
            <form id="createGameForm">
                <div class="form-group">
                    <label class="form-label">ÁêÉÂ±ÄÊ†áÈ¢ò</label>
                    <input type="text" class="form-input" id="gameTitle" placeholder="‰æãÂ¶ÇÔºöÂë®Êú´ÁæΩÊØõÁêÉÊ¨¢‰πêÂ±Ä" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Êó∂Èó¥ËÆæÁΩÆ</label>
                    <div class="time-settings">
                        <div class="time-type-selection">
                            <label class="form-label">Á±ªÂûã</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="timeType" value="temporary" checked>
                                    <span>‰∏¥Êó∂</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="timeType" value="weekly">
                                    <span>ÊØèÂë®</span>
                                </label>
                            </div>
                        </div>
                        
                        <div id="temporaryTimeSettings" class="time-option-content">
                            <div class="time-row">
                                <div>
                                    <label class="form-label">ÊòüÊúü</label>
                                    <select class="form-select" id="weekday" multiple size="5">
                                        <option value="Âë®‰∏Ä">Âë®‰∏Ä</option>
                                        <option value="Âë®‰∫å">Âë®‰∫å</option>
                                        <option value="Âë®‰∏â">Âë®‰∏â</option>
                                        <option value="Âë®Âõõ">Âë®Âõõ</option>
                                        <option value="Âë®‰∫î">Âë®‰∫î</option>
                                        <option value="Âë®ÂÖ≠">Âë®ÂÖ≠</option>
                                        <option value="Âë®Êó•">Âë®Êó•</option>
                                    </select>
                                    <small class="form-hint">Êåâ‰ΩèCtrlÈîÆÂèØÂ§öÈÄâ</small>
                                </div>
                                <div>
                                    <label class="form-label">Êó∂Èó¥ÊÆµ</label>
                                    <select class="form-select" id="timeSlot" multiple size="5">
                                        <option value="18:00-20:00">18:00-20:00</option>
                                        <option value="19:00-21:00">19:00-21:00</option>
                                        <option value="20:00-22:00">20:00-22:00</option>
                                        <option value="14:00-16:00">14:00-16:00</option>
                                        <option value="15:00-17:00">15:00-17:00</option>
                                        <option value="09:00-11:00">09:00-11:00</option>
                                    </select>
                                    <small class="form-hint">Êåâ‰ΩèCtrlÈîÆÂèØÂ§öÈÄâ</small>
                                </div>
                            </div>
                        </div>
                        
                        <div id="weeklyTimeSettings" class="time-option-content" style="display: none;">
                            <div class="time-row">
                                <div>
                                    <label class="form-label">ÊòüÊúüÂá†</label>
                                    <div class="weekday-checkboxes">
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="weeklyDays" value="Âë®‰∏Ä">
                                            <span>Âë®‰∏Ä</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="weeklyDays" value="Âë®‰∫å">
                                            <span>Âë®‰∫å</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="weeklyDays" value="Âë®‰∏â">
                                            <span>Âë®‰∏â</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="weeklyDays" value="Âë®Âõõ">
                                            <span>Âë®Âõõ</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="weeklyDays" value="Âë®‰∫î">
                                            <span>Âë®‰∫î</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="weeklyDays" value="Âë®ÂÖ≠">
                                            <span>Âë®ÂÖ≠</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="weeklyDays" value="Âë®Êó•">
                                            <span>Âë®Êó•</span>
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="form-label">Êó∂Èó¥ÊÆµ</label>
                                    <select class="form-select" id="weeklyTimeSlot">
                                        <option value="">ÈÄâÊã©Êó∂Èó¥ÊÆµ</option>
                                        <option value="18:00-20:00">18:00-20:00</option>
                                        <option value="19:00-21:00">19:00-21:00</option>
                                        <option value="20:00-22:00">20:00-22:00</option>
                                        <option value="14:00-16:00">14:00-16:00</option>
                                        <option value="15:00-17:00">15:00-17:00</option>
                                        <option value="09:00-11:00">09:00-11:00</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">‰∏≠ÁæΩÊ∞¥Âπ≥Á≠âÁ∫ß</label>
                    <select class="form-select" id="badmintonLevel" required>
                        <option value="">ÈÄâÊã©Ê∞¥Âπ≥Á≠âÁ∫ß</option>
                        <option value="1Á∫ß">1Á∫ß - ÂàùÂ≠¶ËÄÖÔºåÂü∫Êú¨Âä®‰Ωú‰∏çÁÜüÁªÉ</option>
                        <option value="2Á∫ß">2Á∫ß - ËÉΩÂÆåÊàêÂü∫Êú¨ÂáªÁêÉÔºå‰ΩÜÁ®≥ÂÆöÊÄßÂ∑Æ</option>
                        <option value="3Á∫ß">3Á∫ß - ÊéåÊè°Âü∫Êú¨ÊäÄÊúØÔºåËÉΩËøõË°åÁÆÄÂçïÂØπÊäó</option>
                        <option value="4Á∫ß">4Á∫ß - ÊäÄÊúØËæÉÂÖ®Èù¢ÔºåËÉΩËøõË°åÊàòÊúØÈÖçÂêà</option>
                        <option value="5Á∫ß">5Á∫ß - ÊäÄÊúØÁÜüÁªÉÔºåÂÖ∑Â§áËæÉÂº∫ÊØîËµõËÉΩÂäõ</option>
                        <option value="6Á∫ß">6Á∫ß - ‰∏ì‰∏öÊ∞¥Âπ≥ÔºåÊäÄÊúØÂÖ®Èù¢Á≤æÊπõ</option>
                    </select>
                    <div class="level-description">ËØ∑Ê†πÊçÆ‰∏≠ÁæΩÁ≠âÁ∫ßÊ†áÂáÜÈÄâÊã©ÊÇ®ÁöÑÊ∞¥Âπ≥</div>
                </div>

                <div class="form-group">
                    <label class="form-label">ÊâìÁêÉËßÜÈ¢ë‰∏ä‰º†Ôºà1-3ÊÆµÔºâ</label>
                    <div class="video-upload">
                        <p>‰∏ä‰º†ÊÇ®ÁöÑÊâìÁêÉËßÜÈ¢ëÔºå‰æõÂèÇ‰∏éËÄÖÂèÇËÄÉÊ∞¥Âπ≥</p>
                        <input type="file" id="videoUpload" accept="video/*" multiple style="display: none;">
                        <button type="button" class="upload-btn" onclick="document.getElementById('videoUpload').click()">
                            ÈÄâÊã©ËßÜÈ¢ëÊñá‰ª∂
                        </button>
                        <div class="level-description">ÊîØÊåÅmp4„ÄÅmovÁ≠âÂ∏∏ËßÅËßÜÈ¢ëÊ†ºÂºèÔºåÊØè‰∏™Êñá‰ª∂‰∏çË∂ÖËøá100MB</div>
                    </div>
                    <div id="uploadedVideos" class="uploaded-videos"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">ËÅîÁ≥ªÊñπÂºè</label>
                    <div>
                        <label class="form-label">ÊâãÊú∫Âè∑ÔºàÂøÖÂ°´Ôºâ</label>
                        <input type="tel" class="form-input" id="phoneNumber" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÊâãÊú∫Âè∑" required pattern="[0-9]{11}">
                    </div>
                    <div style="margin-top: 15px;">
                        <label class="form-label">ÂæÆ‰ø°ÊàñQQÂè∑Ôºà‰∫åÈÄâ‰∏ÄÔºâ</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" class="form-input" id="wechat" placeholder="ÂæÆ‰ø°Âè∑ÔºàÈÄâÂ°´Ôºâ">
                            <input type="text" class="form-input" id="qq" placeholder="QQÂè∑ÔºàÈÄâÂ°´Ôºâ">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Âú∞ÁÇπ</label>
                    <input type="text" class="form-input" id="location" placeholder="‰æãÂ¶ÇÔºöÂ∏Ç‰ΩìËÇ≤È¶ÜÁæΩÊØõÁêÉÈ¶Ü" required>
                </div>

                <div class="form-group">
                    <label class="form-label">ÂèÇ‰∏é‰∫∫Êï∞</label>
                    <select class="form-select" id="playerCount" required>
                        <option value="">ÈÄâÊã©‰∫∫Êï∞</option>
                        <option value="2">2‰∫∫</option>
                        <option value="3">3‰∫∫</option>
                        <option value="4">4‰∫∫</option>
                        <option value="6">6‰∫∫</option>
                        <option value="8">8‰∫∫</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">ÁæΩÊØõÁêÉ‰ø°ÊÅØ</label>
                    <div style="display: flex; gap: 20px;">
                        <div style="flex: 1;">
                            <label class="form-label">ÁæΩÊØõÁêÉÂêçÁß∞</label>
                            <input type="text" class="form-input" id="shuttlecockName" placeholder="ËØ∑ËæìÂÖ•ÁæΩÊØõÁêÉÂêçÁß∞" required>
                        </div>
                        <div style="flex: 1;">
                            <label class="form-label">‰ª∑Ê†º</label>
                            <input type="number" class="form-input" id="shuttlecockPrice" placeholder="ËØ∑ËæìÂÖ•‰ª∑Ê†º" min="0" step="1" required>
                        </div>
                    </div>
                </div>

                <button type="submit" class="submit-btn">ÂàõÂª∫ÁêÉÂ±Ä</button>
            </form>
        </div>
    </div>

    <!-- ËÅäÂ§©Ê®°ÊÄÅÊ°Ü -->
    <div id="chatModal" class="chat-modal">
        <div class="chat-modal-content">
            <div class="chat-header">
                <h2 class="chat-title" id="chatTitle">ÁêÉÂ±ÄËÅäÂ§©ÂÆ§</h2>
                <button class="chat-close-btn" onclick="closeChatModal()">&times;</button>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="empty-chat">
                    <div class="empty-chat-icon">üí¨</div>
                    <p>ËøòÊ≤°ÊúâÊ∂àÊÅØÔºåÂºÄÂßãËÅäÂ§©ÂêßÔºÅ</p>
                </div>
            </div>
            
            <div class="chat-input-area">
                <div class="chat-input-container">
                    <textarea 
                        class="chat-input" 
                        id="chatInput" 
                        placeholder="ËæìÂÖ•Ê∂àÊÅØ..." 
                        rows="1"
                        onkeypress="handleChatKeyPress(event)"
                    ></textarea>
                    <button class="chat-send-btn" onclick="sendMessage()">
                        üì§
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‰∏™‰∫∫‰ø°ÊÅØÊ®°ÊÄÅÊ°Ü -->
    <div id="personalInfoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‰∏™‰∫∫‰ø°ÊÅØ</h2>
                <button class="close-btn" onclick="closePersonalInfoModal()">&times;</button>
            </div>
            
            <div class="detail-content">
                <div class="detail-section">
                    <h3 class="detail-section-title">Âü∫Êú¨‰ø°ÊÅØ</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-icon">üë§</div>
                            <div>
                                <strong>ÂßìÂêç:</strong>
                                <span id="personalName">Âº†‰∏â</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">‚≠ê</div>
                            <div>
                                <strong>ËØÑÂàÜ:</strong>
                                <span id="personalRating" class="level-badge">8.5ÂàÜ</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üë•</div>
                            <div>
                                <strong>ÊÄßÂà´:</strong>
                                <span id="personalGender">Êú™ËÆæÁΩÆ</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üéÇ</div>
                            <div>
                                <strong>Âπ¥ÈæÑ:</strong>
                                <span id="personalAge">Êú™ËÆæÁΩÆ</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üìÖ</div>
                            <div>
                                <strong>ÁîüÊó•:</strong>
                                <span id="personalBirthday">Êú™ËÆæÁΩÆ</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">‚úçÔ∏è</div>
                            <div>
                                <strong>‰∏™ÊÄßÁ≠æÂêç:</strong>
                                <span id="personalSignature">Êú™ËÆæÁΩÆ</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ÂããÁ´†Á≥ªÁªü -->
                <div class="detail-section">
                    <h3 class="detail-section-title">ÊàëÁöÑÂããÁ´†</h3>
                    <div class="badges-container" id="badgesContainer">
                        <div class="badge-item earned" data-badge="icebreaker">
                            <div class="badge-icon">üßä</div>
                            <div class="badge-info">
                                <div class="badge-name">Á†¥ÂÜ∞Ëææ‰∫∫</div>
                                <div class="badge-desc">ÁßØÊûÅÂèÇ‰∏éÊñ∞ÁêÉÂ±Ä</div>
                            </div>
                        </div>
                        <div class="badge-item" data-badge="punctual">
                            <div class="badge-icon">‚è∞</div>
                            <div class="badge-info">
                                <div class="badge-name">ÂÆàÊó∂‰πãÊòü</div>
                                <div class="badge-desc">ÂáÜÊó∂ÂèÇÂä†ÁêÉÂ±Ä</div>
                            </div>
                        </div>
                        <div class="badge-item" data-badge="social">
                            <div class="badge-icon">ü§ù</div>
                            <div class="badge-info">
                                <div class="badge-name">Á§æ‰∫§Ëææ‰∫∫</div>
                                <div class="badge-desc">Ê¥ªË∑ÉÁöÑÁ§æ‰∫§‰∫íÂä®</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h3 class="detail-section-title">ÁºñËæë‰ø°ÊÅØ</h3>
                    <div class="form-group">
                        <label class="form-label">Â§¥ÂÉè</label>
                        <div class="avatar-upload-container">
                            <div class="avatar-preview" id="avatarPreview">
                                <img id="avatarPreviewImage" src="" alt="Â§¥ÂÉèÈ¢ÑËßà" style="display: none;">
                                <div class="avatar-preview-placeholder" id="avatarPreviewPlaceholder">
                                    <div class="avatar-preview-icon">üì∑</div>
                                    <div class="avatar-preview-text">ÁÇπÂáª‰∏ä‰º†Â§¥ÂÉè</div>
                                </div>
                            </div>
                            <input type="file" id="avatarUpload" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
                            <button type="button" class="avatar-upload-btn" onclick="document.getElementById('avatarUpload').click()">ÈÄâÊã©Â§¥ÂÉè</button>
                            <button type="button" class="avatar-remove-btn" id="avatarRemoveBtn" onclick="removeAvatar()" style="display: none;">ÁßªÈô§Â§¥ÂÉè</button>
                        </div>
                        <small style="color: #666; font-size: 0.9em;">ÊîØÊåÅJPG„ÄÅPNGÊ†ºÂºèÔºåÂª∫ËÆÆÂ∞∫ÂØ∏200x200ÂÉèÁ¥†</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÂßìÂêç</label>
                        <input type="text" class="form-input" id="editPersonalName" placeholder="ËØ∑ËæìÂÖ•ÂßìÂêç">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ËØÑÂàÜ</label>
                        <input type="number" class="form-input" id="editPersonalRating" placeholder="Á≥ªÁªüËá™Âä®ËÆ°ÁÆó" min="0" max="10" step="0.1" readonly disabled>
                        <small style="color: #666; font-size: 0.9em;">ËØÑÂàÜÁî±Á≥ªÁªüÊ†πÊçÆÊØîËµõË°®Áé∞Ëá™Âä®ËÆ°ÁÆó</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÊÄßÂà´</label>
                        <select class="form-input" id="editPersonalGender">
                            <option value="">ËØ∑ÈÄâÊã©ÊÄßÂà´</option>
                            <option value="Áî∑">Áî∑</option>
                            <option value="Â•≥">Â•≥</option>
                            <option value="ÂÖ∂‰ªñ">ÂÖ∂‰ªñ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Âπ¥ÈæÑ</label>
                        <input type="number" class="form-input" id="editPersonalAge" placeholder="ËØ∑ËæìÂÖ•Âπ¥ÈæÑ" min="1" max="120">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÁîüÊó•</label>
                        <input type="date" class="form-input" id="editPersonalBirthday">
                    </div>
                    <div class="form-group">
                        <label class="form-label">‰∏™ÊÄßÁ≠æÂêç</label>
                        <textarea class="form-input" id="editPersonalSignature" placeholder="ËØ∑ËæìÂÖ•‰∏™ÊÄßÁ≠æÂêç" rows="3" maxlength="100"></textarea>
                        <small style="color: #666; font-size: 0.9em;">ÊúÄÂ§ö100‰∏™Â≠óÁ¨¶</small>
                    </div>
                    <button type="button" class="submit-btn" onclick="savePersonalInfo()">‰øùÂ≠ò‰ø°ÊÅØ</button>
                    <button type="button" class="logout-btn" onclick="logout()">ÈÄÄÂá∫ÁôªÂΩï</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂéÜÂè≤ÁêÉÂ±ÄÊ®°ÊÄÅÊ°Ü -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ÂéÜÂè≤ÁêÉÂ±Ä</h2>
                <button class="close-btn" onclick="closeHistoryModal()">&times;</button>
            </div>
            
            <div class="detail-content">
                <div class="detail-section">
                    <h3 class="detail-section-title">ÊàëÂèÇ‰∏éÁöÑÁêÉÂ±Ä</h3>
                    <div id="historyGamesList" class="history-games-list">
                        <!-- ÂéÜÂè≤ÁêÉÂ±ÄÂàóË°®Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
                
                <div class="detail-section">
                    <h3 class="detail-section-title">ÁªüËÆ°‰ø°ÊÅØ</h3>
                    <div class="history-stats">
                        <div class="stat-item">
                            <div class="stat-icon">üè∏</div>
                            <div class="stat-info">
                                <div class="stat-label">ÊÄªÂèÇ‰∏éÊ¨°Êï∞</div>
                                <div class="stat-value" id="totalGamesCount">0</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">‚è±Ô∏è</div>
                            <div class="stat-info">
                                <div class="stat-label">ÊÄªËøêÂä®Êó∂Èïø</div>
                                <div class="stat-value" id="totalPlayTime">0Â∞èÊó∂</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">üí∞</div>
                            <div class="stat-info">
                                <div class="stat-label">ÊÄªÊ∂àË¥πÈáëÈ¢ù</div>
                                <div class="stat-value" id="totalCost">¬•0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Â•ΩÂèãÊ®°ÊÄÅÊ°Ü -->
    <div id="friendsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Â•ΩÂèãÂàóË°®</h2>
                <button class="close-btn" onclick="closeFriendsModal()">&times;</button>
            </div>
            
            <div class="detail-content">
                <div class="detail-section" style="margin-bottom: 15px;">
                    <h3 class="detail-section-title" style="margin-bottom: 10px;">Ê∑ªÂä†Â•ΩÂèã</h3>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" class="form-input" id="searchFriend" placeholder="ËæìÂÖ•Áî®Êà∑ÂêçÊàñË¥¶Âè∑" style="flex: 1; padding: 10px 15px; font-size: 1rem; border-radius: 6px;">
                        <button type="button" class="submit-btn" onclick="searchFriend()" style="padding: 6px 8px; font-size: 0.8rem; white-space: nowrap; min-width: 40px; flex-shrink: 0; border-radius: 4px; width: auto; margin-top: 0;">ÊêúÁ¥¢</button>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h3 class="detail-section-title">ÊàëÁöÑÂ•ΩÂèã</h3>
                    <div id="friendsList" class="friends-list">
                        <div class="friend-item" onclick="openFriendProfile('ÊùéÂõõ', 'Ê∏ÖÂçéÂ§ßÂ≠¶', '9.0', ['icebreaker', 'punctual'])">
                            <div class="friend-avatar">üë§</div>
                            <div class="friend-info">
                                <div class="friend-name">ÊùéÂõõ</div>
                                <div class="friend-school">Ê∏ÖÂçéÂ§ßÂ≠¶</div>
                                <div class="friend-rating">ËØÑÂàÜ: 9.0</div>
                            </div>
                            <button class="friend-action-btn" onclick="event.stopPropagation(); inviteFriend('ÊùéÂõõ')">ÈÇÄËØ∑</button>
                        </div>
                        <div class="friend-item" onclick="openFriendProfile('Áéã‰∫î', 'Âåó‰∫¨ÁêÜÂ∑•Â§ßÂ≠¶', '7.8', ['social'])">
                            <div class="friend-avatar">üë§</div>
                            <div class="friend-info">
                                <div class="friend-name">Áéã‰∫î</div>
                                <div class="friend-school">Âåó‰∫¨ÁêÜÂ∑•Â§ßÂ≠¶</div>
                                <div class="friend-rating">ËØÑÂàÜ: 7.8</div>
                            </div>
                            <button class="friend-action-btn" onclick="event.stopPropagation(); inviteFriend('Áéã‰∫î')">ÈÇÄËØ∑</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Â•ΩÂèã‰∏™‰∫∫‰∏ªÈ°µÊ®°ÊÄÅÊ°Ü -->
    <div id="friendProfileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="friendProfileTitle">Â•ΩÂèã‰∏™‰∫∫‰∏ªÈ°µ</h2>
                <button class="close-btn" onclick="closeFriendProfileModal()">&times;</button>
            </div>
            
            <div class="detail-content">
                <div class="detail-section">
                    <h3 class="detail-section-title">Âü∫Êú¨‰ø°ÊÅØ</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-icon">üë§</div>
                            <div>
                                <strong>ÂßìÂêç:</strong>
                                <span id="friendProfileName">Â•ΩÂèãÂßìÂêç</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">‚≠ê</div>
                            <div>
                                <strong>ËØÑÂàÜ:</strong>
                                <span id="friendProfileRating" class="level-badge">0ÂàÜ</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üè´</div>
                            <div>
                                <strong>Â≠¶Ê†°:</strong>
                                <span id="friendProfileSchool">Â≠¶Ê†°ÂêçÁß∞</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Â•ΩÂèãÂããÁ´†Á≥ªÁªü -->
                <div class="detail-section">
                    <h3 class="detail-section-title">TAÁöÑÂããÁ´†</h3>
                    <div class="badges-container" id="friendBadgesContainer">
                        <div class="badge-item" data-badge="icebreaker">
                            <div class="badge-icon">üßä</div>
                            <div class="badge-info">
                                <div class="badge-name">Á†¥ÂÜ∞Ëææ‰∫∫</div>
                                <div class="badge-desc">ÁßØÊûÅÂèÇ‰∏éÊñ∞ÁêÉÂ±Ä</div>
                            </div>
                        </div>
                        <div class="badge-item" data-badge="punctual">
                            <div class="badge-icon">‚è∞</div>
                            <div class="badge-info">
                                <div class="badge-name">ÂÆàÊó∂‰πãÊòü</div>
                                <div class="badge-desc">ÂáÜÊó∂ÂèÇÂä†ÁêÉÂ±Ä</div>
                            </div>
                        </div>
                        <div class="badge-item" data-badge="social">
                            <div class="badge-icon">ü§ù</div>
                            <div class="badge-info">
                                <div class="badge-name">Á§æ‰∫§Ëææ‰∫∫</div>
                                <div class="badge-desc">Ê¥ªË∑ÉÁöÑÁ§æ‰∫§‰∫íÂä®</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h3 class="detail-section-title">Êìç‰Ωú</h3>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button type="button" class="submit-btn" onclick="inviteFriendFromProfile()">ÈÇÄËØ∑ÊâìÁêÉ</button>
                        <button type="button" class="submit-btn" style="background: #28a745;" onclick="sendMessageToFriend()">ÂèëÈÄÅÊ∂àÊÅØ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Êó∂Èó¥ËÆ°ÁÆóËæÖÂä©ÂáΩÊï∞
        function getNextSaturdayAt(hour, minute) {
            const now = new Date();
            const daysUntilSaturday = (6 - now.getDay() + 7) % 7;
            const nextSaturday = new Date(now);
            nextSaturday.setDate(now.getDate() + daysUntilSaturday);
            nextSaturday.setHours(hour, minute, 0, 0);
            return nextSaturday;
        }

        function getNextWeekdayAt(hour, minute) {
            const now = new Date();
            const nextWeekday = new Date(now);
            if (now.getDay() === 0 || now.getDay() === 6) {
                const daysUntilMonday = (1 - now.getDay() + 7) % 7;
                nextWeekday.setDate(now.getDate() + daysUntilMonday);
            }
            nextWeekday.setHours(hour, minute, 0, 0);
            return nextWeekday;
        }

        

        // Âà§Êñ≠ÁêÉÂ±ÄÊòØÂê¶Âç≥Â∞ÜÂºÄÂßãÔºàÂçäÂ∞èÊó∂ÂÜÖÔºâ
        function isGameStartingSoon(game) {
            if (!game.startTime) return false;
            
            const now = new Date();
            const startTime = new Date(game.startTime);
            const timeDiff = startTime - now;
            
            return timeDiff > 0 && timeDiff <= 30 * 60 * 1000;
        }

        // Ëé∑ÂèñÂâ©‰ΩôÊó∂Èó¥ÊòæÁ§∫
        function getTimeRemaining(game) {
            if (!game.startTime) return '';
            
            const now = new Date();
            const startTime = new Date(game.startTime);
            const timeDiff = startTime - now;
            
            if (timeDiff <= 0) return 'Â∑≤ÂºÄÂßã';
            
            const minutes = Math.floor(timeDiff / (1000 * 60));
            const hours = Math.floor(minutes / 60);
            const remainingMinutes = minutes % 60;
            
            if (hours > 0) {
                return `${hours}Â∞èÊó∂${remainingMinutes}ÂàÜÈíüÂêéÂºÄÂßã`;
            } else {
                return `${minutes}ÂàÜÈíüÂêéÂºÄÂßã`;
            }
        }

        // Ê®°ÊÄÅÊ°ÜÊéßÂà∂
        function openCreateModal() {
            console.log('openCreateModalÂáΩÊï∞Ë¢´Ë∞ÉÁî®');
            const modal = document.getElementById('createModal');
            console.log('ÊâæÂà∞Ê®°ÊÄÅÊ°ÜÂÖÉÁ¥†:', modal);
            if (modal) {
                console.log('ËÆæÁΩÆÊ®°ÊÄÅÊ°ÜÊòæÁ§∫');
                modal.style.display = 'block';
                modal.style.animation = 'fadeIn 0.3s ease';
            } else {
                console.error('Êú™ÊâæÂà∞Ê®°ÊÄÅÊ°ÜÂÖÉÁ¥†');
            }
        }

        function closeCreateModal() {
            const modal = document.getElementById('createModal');
            if (modal) {
                modal.style.display = 'none';
            }
            resetForm();
        }

        // ËØ¶ÊÉÖÈ°µÊéßÂà∂ÂáΩÊï∞
        let currentGameId = null;

        function openDetailModal(gameId) {
            console.log('ÊâìÂºÄËØ¶ÊÉÖÈ°µÔºåÁêÉÂ±ÄID:', gameId);
            console.log('gamesÊï∞ÁªÑ:', games);
            currentGameId = gameId;
            const game = games.find(g => g.id === gameId);
            console.log('ÊâæÂà∞ÁöÑÁêÉÂ±Ä:', game);
            
            if (!game) {
                console.error('Êú™ÊâæÂà∞ÁêÉÂ±Ä:', gameId);
                return;
            }

            // Â°´ÂÖÖËØ¶ÊÉÖÈ°µÊï∞ÊçÆ
            document.getElementById('detailTitle').textContent = game.title;
            document.getElementById('detailGameTitle').textContent = game.title;
            document.getElementById('detailLevel').textContent = game.level;
            document.getElementById('detailTime').textContent = game.time;
            document.getElementById('detailLocation').textContent = game.location;
            document.getElementById('detailPlayers').textContent = game.players + '‰∫∫';
            document.getElementById('detailContact').textContent = game.contact;
            
            // ËÆæÁΩÆÁæΩÊØõÁêÉ‰ø°ÊÅØ
            document.getElementById('detailShuttlecockName').textContent = game.shuttlecockName;
            document.getElementById('detailShuttlecockPrice').textContent = game.shuttlecockPrice;
            
            // ËÆæÁΩÆÁªÑÂ±Ä‰∫∫‰ø°ÊÅØ
            document.getElementById('detailOrganizerName').textContent = game.organizer.name;
            const rating = game.organizer.rating;
            const fullStars = Math.floor(rating);
            const emptyStars = 5 - fullStars;
            document.getElementById('detailOrganizerRating').innerHTML = 
                '‚òÖ'.repeat(fullStars) + '‚òÜ'.repeat(emptyStars) + 
                `<span style="color: #666; margin-left: 4px;">(${rating}ÂàÜ)</span>`;

            // ËÆæÁΩÆÂâ©‰ΩôÊó∂Èó¥
            const timeRemaining = getTimeRemaining(game);
            const timeRemainingEl = document.getElementById('detailTimeRemaining');
            if (timeRemaining) {
                timeRemainingEl.textContent = timeRemaining;
                timeRemainingEl.style.display = 'block';
            } else {
                timeRemainingEl.style.display = 'none';
            }

            // ËÆæÁΩÆËßÜÈ¢ëÂàóË°®
            const videosEl = document.getElementById('detailVideos');
            if (game.videos && game.videos.length > 0) {
                videosEl.innerHTML = game.videos.map(video => 
                    `<div class="video-item" onclick="openVideoModal('${video}', ${game.id})">${video}</div>`
                ).join('');
            } else {
                videosEl.innerHTML = '<div style="color: #666;">ÊöÇÊó†ÂèÇËÄÉËßÜÈ¢ë</div>';
            }

            // ËÆæÁΩÆÁêÉÂ±ÄÁä∂ÊÄÅ
            const statusEl = document.getElementById('detailStatus');
            statusEl.className = 'status-info';
            
            if (isGameStartingSoon(game)) {
                statusEl.textContent = '‚ö†Ô∏è Âç≥Â∞ÜÂºÄÂßãÔºà30ÂàÜÈíüÂÜÖÔºâ';
                statusEl.classList.add('urgent');
            } else if (new Date(game.startTime) <= new Date()) {
                statusEl.textContent = '‚úÖ Ê≠£Âú®ËøõË°å‰∏≠';
                statusEl.classList.add('ongoing');
            } else {
                statusEl.textContent = '‚è≥ Âç≥Â∞ÜÂºÄÂßã';
                statusEl.classList.add('upcoming');
            }

            // Âà§Êñ≠ÊòØÂê¶ÊòæÁ§∫Âà†Èô§ÊåâÈíÆÔºàÂè™ÊúâÂΩìÂâçÁî®Êà∑ÂàõÂª∫ÁöÑÁêÉÂ±ÄÊâçÊòæÁ§∫Ôºâ
            const deleteBtn = document.getElementById('deleteGameBtn');
            const joinBtn = document.getElementById('joinGameBtn');
            const endBtn = document.getElementById('endGameBtn');
            
            const isCreator = currentUser && game.organizer && 
                (game.organizer.name === currentUser.name || 
                 game.organizer.name === `Â≠¶Áîü ${currentUser.studentId}`);
            
            if (isCreator) {
                // Â¶ÇÊûúÊòØÂàõÂª∫ËÄÖÔºåÊòæÁ§∫Âà†Èô§ÊåâÈíÆÂíåÁªìÊùüÁêÉÂ±ÄÊåâÈíÆÔºåÈöêËóèÂä†ÂÖ•ÁêÉÂ±ÄÊåâÈíÆ
                deleteBtn.style.display = 'inline-block';
                joinBtn.style.display = 'none';
                endBtn.style.display = 'inline-block';
            } else {
                // Â¶ÇÊûú‰∏çÊòØÂàõÂª∫ËÄÖÔºåÈöêËóèÂà†Èô§ÊåâÈíÆÂíåÁªìÊùüÁêÉÂ±ÄÊåâÈíÆÔºåÊòæÁ§∫Âä†ÂÖ•ÁêÉÂ±ÄÊåâÈíÆ
                deleteBtn.style.display = 'none';
                joinBtn.style.display = 'inline-block';
                endBtn.style.display = 'none';
            }

            // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
            const modal = document.getElementById('detailModal');
            if (modal) {
                modal.style.display = 'block';
                modal.style.animation = 'fadeIn 0.3s ease';
            }
        }

        function closeDetailModal() {
            const modal = document.getElementById('detailModal');
            if (modal) {
                modal.style.display = 'none';
            }
            currentGameId = null;
        }

        function joinGame() {
            if (!currentGameId) return;
            
            // Ê£ÄÊü•ÊØèÊó•ÂèÇ‰∏éÈôêÂà∂
            if (!checkDailyParticipationLimit()) {
                return;
            }
            
            const game = games.find(g => g.id === currentGameId);
            if (game) {
                // ËÆ∞ÂΩïÁî®Êà∑ÂèÇ‰∏éÁêÉÂ±Ä
                recordUserParticipation(currentGameId);
                
                alert(`Â∑≤Áî≥ËØ∑Âä†ÂÖ•ÁêÉÂ±ÄÔºö${game.title}\n\nËØ∑ËÅîÁ≥ªÁªÑÁªáËÄÖÔºö${game.contact}`);
                // ÂèÇÂä†ÁêÉÂ±ÄÊó∂Â¢ûÂä†ÂáÜÊó∂ËÆ∞ÂΩïÂπ∂Ê£ÄÊü•ÂããÁ´†
                addPunctualityRecord();
            }
        }

        // Ê£ÄÊü•ÊØèÊó•ÂèÇ‰∏éÈôêÂà∂
        function checkDailyParticipationLimit() {
            const today = new Date().toDateString();
            const userParticipation = JSON.parse(localStorage.getItem('userDailyParticipation') || '{}');
            
            // Ê£ÄÊü•‰ªäÂ§©ÊòØÂê¶Â∑≤ÁªèÂèÇÂä†ËøáÁêÉÂ±Ä
            if (userParticipation[today]) {
                alert('‚ö†Ô∏è Èò≤‰ΩúÂºäÊèêÈÜí\n\nÊØè‰∫∫ÊØèÂ§©Âè™ËÉΩÂèÇÂä†‰∏Ä‰∏™ÁêÉÂ±ÄÔºÅ\n\nÊÇ®‰ªäÂ§©Â∑≤ÁªèÂèÇÂä†ËøáÁêÉÂ±Ä‰∫ÜÔºåËØ∑ÊòéÂ§©ÂÜçÊù•ÂèÇÂä†Êñ∞ÁöÑÁêÉÂ±Ä„ÄÇ\n\nËøôÊòØ‰∏∫‰∫ÜÁ°Æ‰øùÂÖ¨Âπ≥Á´ûËµõÂíåËµÑÊ∫êÂêàÁêÜÂàÜÈÖç„ÄÇ');
                return false;
            }
            
            return true;
        }

        // ËÆ∞ÂΩïÁî®Êà∑ÂèÇ‰∏éÁêÉÂ±Ä
        function recordUserParticipation(gameId) {
            const today = new Date().toDateString();
            const userParticipation = JSON.parse(localStorage.getItem('userDailyParticipation') || '{}');
            
            // ËÆ∞ÂΩï‰ªäÂ§©ÂèÇÂä†ÁöÑÁêÉÂ±Ä
            userParticipation[today] = {
                gameId: gameId,
                timestamp: new Date().toISOString(),
                date: today
            };
            
            // Ê∏ÖÁêÜ7Â§©ÂâçÁöÑËÆ∞ÂΩïÔºà‰øùÊåÅÊï∞ÊçÆÊï¥Ê¥ÅÔºâ
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            
            Object.keys(userParticipation).forEach(date => {
                if (new Date(date) < sevenDaysAgo) {
                    delete userParticipation[date];
                }
            });
            
            localStorage.setItem('userDailyParticipation', JSON.stringify(userParticipation));
        }

        function endGame() {
            if (!currentGameId) return;
            
            const game = games.find(g => g.id === currentGameId);
            if (game) {
                // Á°ÆËÆ§ÁªìÊùüÁêÉÂ±Ä
                if (confirm(`Á°ÆÂÆöË¶ÅÁªìÊùüÁêÉÂ±Ä"${game.title}"ÂêóÔºü\n\nÁªìÊùüÂêéÂ∞ÜË∑≥ËΩ¨Âà∞ÁªìÁÆóÈ°µÈù¢„ÄÇ`)) {
                    // ÂÖ≥Èó≠ËØ¶ÊÉÖÈ°µÊ®°ÊÄÅÊ°Ü
                    closeDetailModal();
                    
                    // Ë∑≥ËΩ¨Âà∞ÁªìÁÆóÈ°µÈù¢
                    window.location.href = 'game-settlement.html';
                }
            }
        }

        function resetForm() {
            document.getElementById('createGameForm').reset();
            document.getElementById('uploadedVideos').innerHTML = '';
        }

        // ËßÜÈ¢ë‰∏ä‰º†Â§ÑÁêÜ
        document.getElementById('videoUpload').addEventListener('change', function(e) {
            const files = e.target.files;
            const uploadedVideos = document.getElementById('uploadedVideos');
            
            if (files.length > 3) {
                alert('ÊúÄÂ§öÂè™ËÉΩ‰∏ä‰º†3‰∏™ËßÜÈ¢ëÊñá‰ª∂');
                return;
            }
            
            uploadedVideos.innerHTML = '';
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (file.size > 100 * 1024 * 1024) {
                    alert(`Êñá‰ª∂ ${file.name} Ë∂ÖËøá100MBÈôêÂà∂`);
                    continue;
                }
                
                const videoPreview = document.createElement('div');
                videoPreview.className = 'video-preview';
                videoPreview.innerHTML = `
                    <span>üìπ ${file.name}</span>
                    <span style="color: #666; font-size: 0.9rem;">(${(file.size / 1024 / 1024).toFixed(1)}MB)</span>
                `;
                uploadedVideos.appendChild(videoPreview);
            }
        });

        // Ë°®ÂçïÊèê‰∫§Â§ÑÁêÜ
        document.getElementById('createGameForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶Â∑≤ËÆ§ËØÅ
            if (!currentUser) {
                alert('ËØ∑ÂÖàÂÆåÊàêÂ≠¶Ê†°ËÆ§ËØÅÊâçËÉΩÂàõÂª∫ÁêÉÂ±Ä');
                return;
            }
            
            const formData = new FormData(this);
            const phone = document.getElementById('phoneNumber').value;
            const wechat = document.getElementById('wechat').value;
            const qq = document.getElementById('qq').value;
            const shuttlecockName = document.getElementById('shuttlecockName').value;
            const shuttlecockPrice = document.getElementById('shuttlecockPrice').value;
            
            // È™åËØÅËÅîÁ≥ªÊñπÂºè
            if (!wechat && !qq) {
                alert('ËØ∑Ëá≥Â∞ëÂ°´ÂÜôÂæÆ‰ø°Âè∑ÊàñQQÂè∑‰∏≠ÁöÑ‰∏ÄÈ°π');
                return;
            }
            
            // È™åËØÅËßÜÈ¢ëÊï∞Èáè
            const videoFiles = document.getElementById('videoUpload').files;
            if (videoFiles.length === 0) {
                alert('ËØ∑Ëá≥Â∞ë‰∏ä‰º†1ÊÆµÊâìÁêÉËßÜÈ¢ë');
                return;
            }
            
            // Ëé∑ÂèñÊó∂Èó¥ËÆæÁΩÆ
            const timeType = document.querySelector('input[name="timeType"]:checked').value;
            let timeInfo = '';
            
            if (timeType === 'temporary') {
                const selectedWeekdays = Array.from(document.getElementById('weekday').selectedOptions).map(option => option.value);
                const selectedTimeSlots = Array.from(document.getElementById('timeSlot').selectedOptions).map(option => option.value);
                
                if (selectedWeekdays.length === 0 || selectedTimeSlots.length === 0) {
                    alert('ËØ∑ÈÄâÊã©ÊòüÊúüÂíåÊó∂Èó¥ÊÆµ');
                    return;
                }
                
                timeInfo = `‰∏¥Êó∂ - ${selectedWeekdays.join('„ÄÅ')} ${selectedTimeSlots.join('„ÄÅ')}`;
            } else if (timeType === 'weekly') {
                const selectedDays = Array.from(document.querySelectorAll('input[name="weeklyDays"]:checked')).map(cb => cb.value);
                const weeklyTimeSlot = document.getElementById('weeklyTimeSlot').value;
                
                if (selectedDays.length === 0 || !weeklyTimeSlot) {
                    alert('ËØ∑ÈÄâÊã©ÊòüÊúüÂá†ÂíåÊó∂Èó¥ÊÆµ');
                    return;
                }
                
                timeInfo = `ÊØèÂë® - ${selectedDays.join('„ÄÅ')} ${weeklyTimeSlot}`;
            }
            
            const contactInfo = `${phone}Ôºà${wechat ? 'ÂæÆ‰ø°: ' + wechat : 'QQ: ' + qq}Ôºâ`;
            
            const newGame = {
                id: games.length + 1,
                title: document.getElementById('gameTitle').value,
                level: document.getElementById('badmintonLevel').value,
                time: timeInfo,
                timeType: timeType,
                startTime: calculateStartTime(timeType === 'temporary' ? 
                    Array.from(document.getElementById('weekday').selectedOptions)[0]?.value : 
                    Array.from(document.querySelectorAll('input[name="weeklyDays"]:checked'))[0]?.value, 
                    timeType === 'temporary' ? 
                    Array.from(document.getElementById('timeSlot').selectedOptions)[0]?.value : 
                    document.getElementById('weeklyTimeSlot').value),
                location: document.getElementById('location').value,
                contact: contactInfo,
                players: parseInt(document.getElementById('playerCount').value),
                videos: Array.from(videoFiles).map(file => file.name),
                school: currentUser.school, // Ê∑ªÂä†Â≠¶Ê†°‰ø°ÊÅØ
                shuttlecockName: shuttlecockName,
                shuttlecockPrice: shuttlecockPrice,
                organizer: {
                    name: currentUser.name || `Â≠¶Áîü ${currentUser.studentId}`,
                    rating: 4.0 // ÈªòËÆ§ËØÑÂàÜ
                }
            };
            
            games.push(newGame);
            
            // ÂêåÊó∂Ê∑ªÂä†Âà∞ÂΩìÂâçÂ≠¶Ê†°ÁöÑÁêÉÂ±ÄÊï∞ÊçÆ
            if (schoolGames[currentUser.school]) {
                schoolGames[currentUser.school].push(newGame);
            }
            
            // ‰øùÂ≠òÁêÉÂ±ÄÊï∞ÊçÆÂà∞Êú¨Âú∞Â≠òÂÇ®
            saveGamesToStorage();
            
            renderGames();
            closeCreateModal();
            
            // ÊòæÁ§∫ÊàêÂäüÊèêÁ§∫
            alert('ÁêÉÂ±ÄÂàõÂª∫ÊàêÂäüÔºÅ');
            
            // ÂàõÂª∫ÁêÉÂ±ÄÂêéÊ£ÄÊü•ÂããÁ´†
            checkAndAwardBadges();
        });

        // ËÆ°ÁÆóÂºÄÂßãÊó∂Èó¥
        function calculateStartTime(weekday, timeSlot) {
            const startHour = parseInt(timeSlot.split(':')[0]);
            const now = new Date();
            let targetDate = new Date(now);
            
            switch(weekday) {
                case 'Âë®‰∏Ä': targetDate.setDate(now.getDate() + (1 - now.getDay() + 7) % 7); break;
                case 'Âë®‰∫å': targetDate.setDate(now.getDate() + (2 - now.getDay() + 7) % 7); break;
                case 'Âë®‰∏â': targetDate.setDate(now.getDate() + (3 - now.getDay() + 7) % 7); break;
                case 'Âë®Âõõ': targetDate.setDate(now.getDate() + (4 - now.getDay() + 7) % 7); break;
                case 'Âë®‰∫î': targetDate.setDate(now.getDate() + (5 - now.getDay() + 7) % 7); break;
                case 'Âë®ÂÖ≠': targetDate.setDate(now.getDate() + (6 - now.getDay() + 7) % 7); break;
                case 'Âë®Êó•': targetDate.setDate(now.getDate() + (7 - now.getDay()) % 7); break;
                case 'Â∑•‰ΩúÊó•': 
                    if (now.getDay() === 0 || now.getDay() === 6) {
                        targetDate.setDate(now.getDate() + (1 - now.getDay() + 7) % 7);
                    }
                    break;
                case 'Âë®Êú´':
                    if (now.getDay() >= 1 && now.getDay() <= 5) {
                        targetDate.setDate(now.getDate() + (6 - now.getDay() + 7) % 7);
                    }
                    break;
            }
            
            targetDate.setHours(startHour, 0, 0, 0);
            return targetDate;
        }



        // Á≠õÈÄâÂäüËÉΩ
        let filteredGames = [];
        let isFiltered = false;

        function applyFilters() {
            const timeFilter = document.getElementById('timeFilter').value;
            const locationFilter = document.getElementById('locationFilter').value;
            const levelFilter = document.getElementById('levelFilter').value;
            
            // Âè™Á≠õÈÄâÂΩìÂâçÂ≠¶Ê†°ÁöÑÁêÉÂ±Ä
            const currentSchoolGames = currentUser ? games.filter(game => game.school === currentUser.school) : [];
            
            filteredGames = currentSchoolGames.filter(game => {
                let match = true;
                
                // Êó∂Èó¥Á≠õÈÄâ
                if (timeFilter && !game.time.includes(timeFilter)) {
                    match = false;
                }
                
                // Âú∞ÁÇπÁ≠õÈÄâ
                if (locationFilter && locationFilter !== "ÂÖ®ÈÉ®Âú∞ÁÇπ") {
                    // Ê£ÄÊü•Âú∞ÁÇπÊòØÂê¶ÂåÖÂê´Á≠õÈÄâÊñáÊú¨Ôºà‰∏çÂå∫ÂàÜÂ§ßÂ∞èÂÜôÔºâ
                    if (!game.location.toLowerCase().includes(locationFilter.toLowerCase())) {
                        match = false;
                    }
                }
                
                // Ê∞¥Âπ≥Á≠õÈÄâ
                if (levelFilter && game.level !== levelFilter) {
                    match = false;
                }
                
                return match;
            });
            
            isFiltered = true;
            renderFilteredGames();
        }

        function resetFilters() {
            document.getElementById('timeFilter').value = '';
            document.getElementById('locationFilter').value = '';
            document.getElementById('levelFilter').value = '';
            
            isFiltered = false;
            renderGames();
        }

        function renderFilteredGames() {
            const gamesList = document.getElementById('gamesList');
            
            if (filteredGames.length === 0) {
                gamesList.innerHTML = `
                    <div class="empty-state">
                        <h3>ÊöÇÊó†Á¨¶ÂêàÊù°‰ª∂ÁöÑÁêÉÂ±Ä</h3>
                        <p>ËØ∑Ë∞ÉÊï¥Á≠õÈÄâÊù°‰ª∂ÊàñÂàõÂª∫Êñ∞ÁöÑÁêÉÂ±Ä</p>
                    </div>
                `;
                return;
            }

            gamesList.innerHTML = filteredGames.map(game => {
                const isUrgent = isGameStartingSoon(game);
                const timeRemaining = getTimeRemaining(game);
                
                return `
                <div class="game-item ${isUrgent ? 'urgent' : ''}" onclick="event.preventDefault(); openDetailModal(${game.id});">
                    <div class="game-header">
                        <div class="game-title">
                            ${game.title}
                            ${isUrgent ? '<span class="urgent-badge">Âç≥Â∞ÜÂºÄÂßã</span>' : ''}
                        </div>
                        <div class="level-badge">${game.level}</div>
                    </div>
                    <div class="game-details">
                        <div class="detail-item">
                            <div class="detail-icon">‚è∞</div>
                            <div>
                                <strong>Êó∂Èó¥:</strong> ${game.time}
                                ${timeRemaining ? `<br><small style="color: ${isUrgent ? '#ff5722' : '#666'}; font-weight: bold;">${timeRemaining}</small>` : ''}
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üìç</div>
                            <div><strong>Âú∞ÁÇπ:</strong> ${game.location}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üë•</div>
                            <div><strong>‰∫∫Êï∞:</strong> ${game.players}‰∫∫</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üè∏</div>
                            <div>
                                <strong>ÁæΩÊØõÁêÉ‰ø°ÊÅØ:</strong> ${game.shuttlecockName} - ${game.shuttlecockPrice}ÂÖÉ
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üë§</div>
                            <div>
                                <strong>ÁªÑÂ±Ä‰∫∫:</strong> ${game.organizer.name}
                                <div style="color: #ffa726; font-size: 0.9em;">
                                    ${'‚òÖ'.repeat(Math.floor(game.organizer.rating))}${'‚òÜ'.repeat(5 - Math.floor(game.organizer.rating))}
                                    <span style="color: #666; margin-left: 4px;">(${game.organizer.rating}ÂàÜ)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    ${game.videos && game.videos.length > 0 ? `
                    <div class="videos-section">
                        <strong>ÂèÇËÄÉËßÜÈ¢ë:</strong>
                        <div class="video-list">
                            ${game.videos.map(video => `<span class="video-item" onclick="openVideoModal('${video}', ${game.id})">${video}</span>`).join('')}
                        </div>
                    </div>
                    ` : ''}
                    <div class="contact-info">
                        <span class="contact-label">üìû ËÅîÁ≥ªÊñπÂºè:</span>
                        ${game.contact}
                    </div>
                </div>
                `;
            }).join('');
        }

        // ‰øÆÊîπrenderGamesÂáΩÊï∞‰ª•ÊîØÊåÅÁ≠õÈÄâÁä∂ÊÄÅÂíåÂ≠¶Ê†°ËÆ§ËØÅ
        function renderGames() {
            console.log('renderGamesÂáΩÊï∞Ë¢´Ë∞ÉÁî®');
            console.log('isFiltered:', isFiltered);
            console.log('currentUser:', currentUser);
            console.log('gamesÊï∞ÁªÑ:', games);
            
            if (isFiltered) {
                renderFilteredGames();
                return;
            }
            
            const gamesList = document.getElementById('gamesList');
            console.log('gamesListÂÖÉÁ¥†:', gamesList);
            
            // Âè™ÊòæÁ§∫ÂΩìÂâçÂ≠¶Ê†°ÁöÑÁêÉÂ±Ä
            const currentSchoolGames = currentUser ? games.filter(game => game.school === currentUser.school) : [];
            console.log('ÂΩìÂâçÂ≠¶Ê†°ÁöÑÁêÉÂ±Ä:', currentSchoolGames);
            
            if (currentSchoolGames.length === 0) {
                console.log('Ê≤°ÊúâÊâæÂà∞ÂΩìÂâçÂ≠¶Ê†°ÁöÑÁêÉÂ±ÄÔºåÊòæÁ§∫Á©∫Áä∂ÊÄÅ');
                gamesList.innerHTML = `
                    <div class="empty-state">
                        <h3>ÊöÇÊó†ÁêÉÂ±Ä</h3>
                        <p>ÁÇπÂáª‰∏ãÊñπÊåâÈíÆÂàõÂª∫Á¨¨‰∏Ä‰∏™ÁêÉÂ±Ä</p>
                    </div>
                `;
                return;
            }

            gamesList.innerHTML = currentSchoolGames.map(game => {
                const isUrgent = isGameStartingSoon(game);
                const timeRemaining = getTimeRemaining(game);
                
                return `
                <div class="game-item ${isUrgent ? 'urgent' : ''}" onclick="event.preventDefault(); openDetailModal(${game.id});">
                    <div class="game-header">
                        <div class="game-title">
                            ${game.title}
                            ${isUrgent ? '<span class="urgent-badge">Âç≥Â∞ÜÂºÄÂßã</span>' : ''}
                        </div>
                        <div class="level-badge">${game.level}</div>
                    </div>
                    <div class="game-details">
                        <div class="detail-item">
                            <div class="detail-icon">‚è∞</div>
                            <div>
                                <strong>Êó∂Èó¥:</strong> ${game.time}
                                ${timeRemaining ? `<br><small style="color: ${isUrgent ? '#ff5722' : '#666'}; font-weight: bold;">${timeRemaining}</small>` : ''}
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üìç</div>
                            <div><strong>Âú∞ÁÇπ:</strong> ${game.location}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üë•</div>
                            <div><strong>‰∫∫Êï∞:</strong> ${game.players}‰∫∫</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üè∏</div>
                            <div>
                                <strong>ÁæΩÊØõÁêÉ‰ø°ÊÅØ:</strong> ${game.shuttlecockName} - ${game.shuttlecockPrice}ÂÖÉ
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üë§</div>
                            <div>
                                <strong>ÁªÑÂ±Ä‰∫∫:</strong> ${game.organizer.name}
                                <div style="color: #ffa726; font-size: 0.9em;">
                                    ${'‚òÖ'.repeat(Math.floor(game.organizer.rating))}${'‚òÜ'.repeat(5 - Math.floor(game.organizer.rating))}
                                    <span style="color: #666; margin-left: 4px;">(${game.organizer.rating}ÂàÜ)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    ${game.videos && game.videos.length > 0 ? `
                    <div class="videos-section">
                        <strong>ÂèÇËÄÉËßÜÈ¢ë:</strong>
                        <div class="video-list">
                            ${game.videos.map(video => `<span class="video-item" onclick="openVideoModal('${video}', ${game.id})">${video}</span>`).join('')}
                        </div>
                    </div>
                    ` : ''}
                    <div class="contact-info">
                        <span class="contact-label">üìû ËÅîÁ≥ªÊñπÂºè:</span>
                        ${game.contact}
                    </div>
                </div>
                `;
            }).join('');
        }

        // ËÆ§ËØÅÂäüËÉΩ
        let currentUser = null;
        let schoolGames = {};
        let games = [];

        // ÂàùÂßãÂåñÂ≠¶Ê†°ÁêÉÂ±ÄÊï∞ÊçÆ
        function initializeSchoolGames() {
            console.log('ÂºÄÂßãÂàùÂßãÂåñÂ≠¶Ê†°ÁêÉÂ±ÄÊï∞ÊçÆ');
            
            // ÊâÄÊúâ985Âíå211È´òÊ†°ÂàóË°®
            const schools = [
                // 985È´òÊ†°
                'Âåó‰∫¨Â§ßÂ≠¶', 'Ê∏ÖÂçéÂ§ßÂ≠¶', 'Â§çÊó¶Â§ßÂ≠¶', '‰∏äÊµ∑‰∫§ÈÄöÂ§ßÂ≠¶', 'ÊµôÊ±üÂ§ßÂ≠¶',
                'Âçó‰∫¨Â§ßÂ≠¶', '‰∏≠ÂõΩÁßëÂ≠¶ÊäÄÊúØÂ§ßÂ≠¶', 'ÂìàÂ∞îÊª®Â∑•‰∏öÂ§ßÂ≠¶', 'Ë•øÂÆâ‰∫§ÈÄöÂ§ßÂ≠¶',
                '‰∏≠ÂõΩ‰∫∫Ê∞ëÂ§ßÂ≠¶', 'Âåó‰∫¨Ëà™Á©∫Ëà™Â§©Â§ßÂ≠¶', 'Âåó‰∫¨ÁêÜÂ∑•Â§ßÂ≠¶', '‰∏≠ÂõΩÂÜú‰∏öÂ§ßÂ≠¶',
                'Âåó‰∫¨Â∏àËåÉÂ§ßÂ≠¶', '‰∏≠Â§ÆÊ∞ëÊóèÂ§ßÂ≠¶', 'ÂçóÂºÄÂ§ßÂ≠¶', 'Â§©Ê¥•Â§ßÂ≠¶', 'Â§ßËøûÁêÜÂ∑•Â§ßÂ≠¶',
                '‰∏úÂåóÂ§ßÂ≠¶', 'ÂêâÊûóÂ§ßÂ≠¶', 'ÂêåÊµéÂ§ßÂ≠¶', 'Âçé‰∏úÂ∏àËåÉÂ§ßÂ≠¶', '‰∏úÂçóÂ§ßÂ≠¶',
                'Âé¶Èó®Â§ßÂ≠¶', 'Â±±‰∏úÂ§ßÂ≠¶', '‰∏≠ÂõΩÊµ∑Ê¥ãÂ§ßÂ≠¶', 'Ê≠¶Ê±âÂ§ßÂ≠¶', 'Âçé‰∏≠ÁßëÊäÄÂ§ßÂ≠¶',
                '‰∏≠ÂçóÂ§ßÂ≠¶', '‰∏≠Â±±Â§ßÂ≠¶', 'ÂçéÂçóÁêÜÂ∑•Â§ßÂ≠¶', 'ÂõõÂ∑ùÂ§ßÂ≠¶', 'ÁîµÂ≠êÁßëÊäÄÂ§ßÂ≠¶',
                'ÈáçÂ∫ÜÂ§ßÂ≠¶', 'Ë•øÂåóÂ∑•‰∏öÂ§ßÂ≠¶', 'ÂÖ∞Â∑ûÂ§ßÂ≠¶', 'ÂõΩÈò≤ÁßëÊäÄÂ§ßÂ≠¶',
                
                // 211È´òÊ†°
                'Âåó‰∫¨‰∫§ÈÄöÂ§ßÂ≠¶', 'Âåó‰∫¨Â∑•‰∏öÂ§ßÂ≠¶', 'Âåó‰∫¨ÁßëÊäÄÂ§ßÂ≠¶', 'Âåó‰∫¨ÂåñÂ∑•Â§ßÂ≠¶',
                'Âåó‰∫¨ÈÇÆÁîµÂ§ßÂ≠¶', 'Âåó‰∫¨Êûó‰∏öÂ§ßÂ≠¶', 'Âåó‰∫¨‰∏≠ÂåªËçØÂ§ßÂ≠¶', 'Âåó‰∫¨Â§ñÂõΩËØ≠Â§ßÂ≠¶',
                '‰∏≠ÂõΩ‰º†Â™íÂ§ßÂ≠¶', '‰∏≠Â§ÆË¥¢ÁªèÂ§ßÂ≠¶', 'ÂØπÂ§ñÁªèÊµéË¥∏ÊòìÂ§ßÂ≠¶', 'Âåó‰∫¨‰ΩìËÇ≤Â§ßÂ≠¶',
                '‰∏≠Â§ÆÈü≥‰πêÂ≠¶Èô¢', '‰∏≠ÂõΩÊîøÊ≥ïÂ§ßÂ≠¶', 'ÂçéÂåóÁîµÂäõÂ§ßÂ≠¶', 'Â§©Ê¥•ÂåªÁßëÂ§ßÂ≠¶',
                'Ê≤≥ÂåóÂ∑•‰∏öÂ§ßÂ≠¶', 'Â§™ÂéüÁêÜÂ∑•Â§ßÂ≠¶', 'ÂÜÖËíôÂè§Â§ßÂ≠¶', 'ËæΩÂÆÅÂ§ßÂ≠¶',
                'Â§ßËøûÊµ∑‰∫ãÂ§ßÂ≠¶', 'Âª∂ËæπÂ§ßÂ≠¶', '‰∏úÂåóÂ∏àËåÉÂ§ßÂ≠¶', 'ÂìàÂ∞îÊª®Â∑•Á®ãÂ§ßÂ≠¶',
                '‰∏úÂåóÂÜú‰∏öÂ§ßÂ≠¶', '‰∏úÂåóÊûó‰∏öÂ§ßÂ≠¶', 'Âçé‰∏úÁêÜÂ∑•Â§ßÂ≠¶', '‰∏úÂçéÂ§ßÂ≠¶',
                '‰∏äÊµ∑Â§ñÂõΩËØ≠Â§ßÂ≠¶', '‰∏äÊµ∑Ë¥¢ÁªèÂ§ßÂ≠¶', '‰∏äÊµ∑Â§ßÂ≠¶', 'ËãèÂ∑ûÂ§ßÂ≠¶',
                'Âçó‰∫¨Ëà™Á©∫Ëà™Â§©Â§ßÂ≠¶', 'Âçó‰∫¨ÁêÜÂ∑•Â§ßÂ≠¶', '‰∏≠ÂõΩÁüø‰∏öÂ§ßÂ≠¶', 'Ê≤≥Êµ∑Â§ßÂ≠¶',
                'Ê±üÂçóÂ§ßÂ≠¶', 'Âçó‰∫¨ÂÜú‰∏öÂ§ßÂ≠¶', '‰∏≠ÂõΩËçØÁßëÂ§ßÂ≠¶', 'Âçó‰∫¨Â∏àËåÉÂ§ßÂ≠¶',
                'ÂÆâÂæΩÂ§ßÂ≠¶', 'ÂêàËÇ•Â∑•‰∏öÂ§ßÂ≠¶', 'Á¶èÂ∑ûÂ§ßÂ≠¶', 'ÂçóÊòåÂ§ßÂ≠¶',
                '‰∏≠ÂõΩÁü≥Ê≤πÂ§ßÂ≠¶', 'ÈÉëÂ∑ûÂ§ßÂ≠¶', '‰∏≠ÂõΩÂú∞Ë¥®Â§ßÂ≠¶', 'Ê≠¶Ê±âÁêÜÂ∑•Â§ßÂ≠¶',
                'Âçé‰∏≠ÂÜú‰∏öÂ§ßÂ≠¶', 'Âçé‰∏≠Â∏àËåÉÂ§ßÂ≠¶', '‰∏≠ÂçóË¥¢ÁªèÊîøÊ≥ïÂ§ßÂ≠¶', 'ÊπñÂçóÂ∏àËåÉÂ§ßÂ≠¶',
                'Êö®ÂçóÂ§ßÂ≠¶', 'ÂçéÂçóÂ∏àËåÉÂ§ßÂ≠¶', 'ÂπøË•øÂ§ßÂ≠¶', 'Êµ∑ÂçóÂ§ßÂ≠¶',
                'Ë•øÂçó‰∫§ÈÄöÂ§ßÂ≠¶', 'Ë•øÂçóÁü≥Ê≤πÂ§ßÂ≠¶', 'ÊàêÈÉΩÁêÜÂ∑•Â§ßÂ≠¶', 'ÂõõÂ∑ùÂÜú‰∏öÂ§ßÂ≠¶',
                'Ë•øÂçóË¥¢ÁªèÂ§ßÂ≠¶', 'Ë¥µÂ∑ûÂ§ßÂ≠¶', '‰∫ëÂçóÂ§ßÂ≠¶', 'Ë•øÂåóÂ§ßÂ≠¶',
                'Ë•øÂÆâÁîµÂ≠êÁßëÊäÄÂ§ßÂ≠¶', 'ÈïøÂÆâÂ§ßÂ≠¶', 'ÈôïË•øÂ∏àËåÉÂ§ßÂ≠¶', 'Ë•øÂåóÂÜúÊûóÁßëÊäÄÂ§ßÂ≠¶',
                'ÈùíÊµ∑Â§ßÂ≠¶', 'ÂÆÅÂ§èÂ§ßÂ≠¶', 'Êñ∞ÁñÜÂ§ßÂ≠¶', 'Áü≥Ê≤≥Â≠êÂ§ßÂ≠¶'
            ];
            
            schools.forEach(school => {
                schoolGames[school] = [
                    {
                        id: Date.now() + Math.random(),
                        title: `${school}ÁæΩÊØõÁêÉÂèãË∞äËµõ`,
                        level: "3Á∫ß",
                        time: "Âë®‰∫î 19:00-21:00",
                        location: `${school}‰ΩìËÇ≤È¶Ü`,
                        players: "8",
                        contact: "ÊùéËÄÅÂ∏à 13800138000",
                        videos: ["Âü∫Á°ÄÊïôÂ≠¶", "ÊØîËµõÊäÄÂ∑ß"],
                        school: school,
                        shuttlecockName: "ËÉúÂà©ÈáëÈªÑ1Âè∑",
                        shuttlecockPrice: "35",
                        organizer: {
                            name: "ÊùéËÄÅÂ∏à",
                            rating: 4.5
                        }
                    },
                    {
                        id: Date.now() + Math.random() + 1,
                        title: `${school}Âë®Êú´ÁæΩÊØõÁêÉÊ¥ªÂä®`,
                        level: "2Á∫ß",
                        time: "Âë®ÂÖ≠ 14:00-16:00",
                        location: `${school}‰ΩìËÇ≤È¶Ü`,
                        players: "12",
                        contact: "ÁéãÂêåÂ≠¶ 13900139000",
                        videos: ["ÂÖ•Èó®ÊïôÁ®ã", "ÂèåÊâìÈÖçÂêà"],
                        school: school,
                        shuttlecockName: "Â∞§Â∞ºÂÖãÊñØAS-05",
                        shuttlecockPrice: "28",
                        organizer: {
                            name: "ÁéãÂêåÂ≠¶",
                            rating: 3.8
                        }
                    }
                ];
            });
            
            console.log('Â≠¶Ê†°ÁêÉÂ±ÄÊï∞ÊçÆÂàùÂßãÂåñÂÆåÊàêÔºåÂÖ±', schools.length, '‰∏™Â≠¶Ê†°');
            console.log('schoolGamesÂØπË±°:', schoolGames);
        }

        // ËÆ§ËØÅÈ™åËØÅÂáΩÊï∞
        function authenticateUser() {
            return true;
        }


        


        // Ê£ÄÊü•Êú¨Âú∞Â≠òÂÇ®‰∏≠ÁöÑËÆ§ËØÅ‰ø°ÊÅØ
        function checkStoredAuth() {
            // Áõ¥Êé•ÂàõÂª∫ÈªòËÆ§Áî®Êà∑
            currentUser = {
                studentId: '00000000',
                school: '‰∏≠ÂõΩÁüø‰∏öÂ§ßÂ≠¶'
            };
            
            games = schoolGames[currentUser.school] || [];
            
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            updateSchoolInterface();
            updateUserInfo();
            renderGames();
            
            // ‰øùÂ≠òËÆ§ËØÅ‰ø°ÊÅØÂà∞Êú¨Âú∞Â≠òÂÇ®
            localStorage.setItem('badmintonAuth', JSON.stringify(currentUser));
            return true;
        }

        // Â≠¶Ê†°ÊêúÁ¥¢ÂäüËÉΩ - Êô∫ËÉΩÊêúÁ¥¢ÈÄâÊã©Ê°Ü
        function setupSchoolSearch() {
            const smartSchoolSearch = document.getElementById('smartSchoolSearch');
            
            if (smartSchoolSearch) {
                // Ê∑ªÂä†ËæìÂÖ•È™åËØÅÂäüËÉΩ
                smartSchoolSearch.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.trim();
                    const datalistOptions = document.getElementById('schoolOptions').options;
                    
                    // Êü•ÊâæÂÆåÂÖ®ÂåπÈÖçÁöÑÂ≠¶Ê†°
                    const exactMatch = Array.from(datalistOptions).find(option => 
                        option.value.toLowerCase() === searchTerm.toLowerCase()
                    );
                    
                    if (exactMatch) {
                        // Â¶ÇÊûúÊâæÂà∞ÂÆåÂÖ®ÂåπÈÖçÁöÑÂ≠¶Ê†°ÔºåÈ™åËØÅÈÄöËøá
                        smartSchoolSearch.setCustomValidity('');
                    } else if (searchTerm) {
                        // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÂ≠¶Ê†°ÔºåËÆæÁΩÆÈ™åËØÅÈîôËØØ
                        smartSchoolSearch.setCustomValidity('ËØ∑‰ªéÂàóË°®‰∏≠ÈÄâÊã©ÊúâÊïàÁöÑÂ≠¶Ê†°');
                    } else {
                        // Â¶ÇÊûú‰∏∫Á©∫ÔºåÊ∏ÖÈô§È™åËØÅÈîôËØØ
                        smartSchoolSearch.setCustomValidity('');
                    }
                });
                
                // Ê∑ªÂä†ÁÑ¶ÁÇπ‰∫ã‰ª∂Â§ÑÁêÜ
                smartSchoolSearch.addEventListener('focus', function() {
                    smartSchoolSearch.select();
                });
                
                // Ê∑ªÂä†ÈîÆÁõòÂø´Êç∑ÈîÆÊîØÊåÅ
                smartSchoolSearch.addEventListener('keydown', function(e) {
                    if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        // Ëß¶ÂèëÊµèËßàÂô®ÂéüÁîüÁöÑdatalist‰∏ãÊãâÊòæÁ§∫
                        smartSchoolSearch.click();
                    }
                });
            }
        }

        // Êõ¥Êñ∞Â≠¶Ê†°ÁïåÈù¢ÊòæÁ§∫
        function updateSchoolInterface() {
            if (currentUser) {
                const schoolBadge = document.getElementById('schoolBadge');
                const schoolWelcome = document.getElementById('schoolWelcome');
                const schoolBackground = document.getElementById('schoolBackground');
                
                // ËÆæÁΩÆÊ†°ÂæΩ
                const schoolEmojis = {
                    'Ê∏ÖÂçéÂ§ßÂ≠¶': 'üéì',
                    'Âåó‰∫¨Â§ßÂ≠¶': 'üìö',
                    'Â§çÊó¶Â§ßÂ≠¶': 'üèõÔ∏è',
                    '‰∏äÊµ∑‰∫§ÈÄöÂ§ßÂ≠¶': '‚öì',
                    'ÊµôÊ±üÂ§ßÂ≠¶': 'üå≥',
                    'Âçó‰∫¨Â§ßÂ≠¶': 'üèØ',
                    'Ê≠¶Ê±âÂ§ßÂ≠¶': 'üå∏',
                    '‰∏≠Â±±Â§ßÂ≠¶': 'üåÖ',
                    'ÂõõÂ∑ùÂ§ßÂ≠¶': 'üêº',
                    'Ë•øÂÆâ‰∫§ÈÄöÂ§ßÂ≠¶': 'üèÆ'
                };
                
                if (schoolBadge) {
                    schoolBadge.textContent = schoolEmojis[currentUser.school] || 'üè´';
                }
                
                // ËÆæÁΩÆÊ¨¢Ëøé‰ø°ÊÅØ
                if (schoolWelcome) {
                    schoolWelcome.textContent = `Âø´Êù•Âä†ÂÖ•ÁæΩÁêÉÂ§ßÂÆ∂Â∫≠Ôºå‰∏éÂêåÂ≠¶‰ª¨‰∏ÄËµ∑‰∫§ÊµÅÂàáÁ£ãÂêß~`;
                }
                
                // ËÆæÁΩÆÂ≠¶Ê†°ËÉåÊôØÂõæÁâáÔºà‰ΩøÁî®UnsplashÁöÑ‰∏çÂêåÂ§ßÂ≠¶È£éÊôØÂõæÁâáÔºâ
                const schoolBackgrounds = {
                    'Ê∏ÖÂçéÂ§ßÂ≠¶': 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=800',
                    'Âåó‰∫¨Â§ßÂ≠¶': 'https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800',
                    'Â§çÊó¶Â§ßÂ≠¶': 'https://images.unsplash.com/photo-1562774053-701939374585?w=800',
                    '‰∏äÊµ∑‰∫§ÈÄöÂ§ßÂ≠¶': 'https://images.unsplash.com/photo-1523240795612-9a054b0db644?w=800',
                    'ÊµôÊ±üÂ§ßÂ≠¶': 'https://images.unsplash.com/photo-1560785496-3c9d27877182?w=800',
                    'Âçó‰∫¨Â§ßÂ≠¶': 'https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=800',
                    'Ê≠¶Ê±âÂ§ßÂ≠¶': 'https://images.unsplash.com/photo-1571624436279-b272aff752b5?w=800',
                    '‰∏≠Â±±Â§ßÂ≠¶': 'https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=800',
                    'ÂõõÂ∑ùÂ§ßÂ≠¶': 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=800',
                    'Ë•øÂÆâ‰∫§ÈÄöÂ§ßÂ≠¶': 'https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800'
                };
                
                if (schoolBackground) {
                    schoolBackground.style.backgroundImage = `url(${schoolBackgrounds[currentUser.school] || 'https://images.unsplash.com/photo-1562774053-701939374585?w=800'})`;
                    schoolBackground.style.opacity = '0.15';
                }
            }
        }

        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded‰∫ã‰ª∂Ëß¶Âèë');
            
            try {
                // ÂàùÂßãÂåñËÅäÂ§©ÂäüËÉΩ
                loadChatMessagesFromStorage();
                
                // Â∞ùËØï‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÁêÉÂ±ÄÊï∞ÊçÆ
                const hasStoredGames = loadGamesFromStorage();
                
                if (!hasStoredGames) {
                    // Â¶ÇÊûúÊ≤°ÊúâÂ≠òÂÇ®ÁöÑÊï∞ÊçÆÔºåÂàôÂàùÂßãÂåñÂ≠¶Ê†°ÁêÉÂ±ÄÊï∞ÊçÆÔºàÂåÖÂê´ÈªòËÆ§ÊºîÁ§∫ÁêÉÂ±ÄÔºâ
                    initializeSchoolGames();
                    console.log('Â≠¶Ê†°ÁêÉÂ±ÄÊï∞ÊçÆÂàùÂßãÂåñÂÆåÊàê');
                    
                    // ‰∏∫ÂΩìÂâçÁî®Êà∑ËÆæÁΩÆÁêÉÂ±ÄÊï∞ÊçÆ
                    if (currentUser && schoolGames[currentUser.school]) {
                        games = schoolGames[currentUser.school];
                        console.log('‰∏∫ÂΩìÂâçÁî®Êà∑ËÆæÁΩÆÁêÉÂ±ÄÊï∞ÊçÆ:', games.length, '‰∏™ÁêÉÂ±Ä');
                    }
                } else {
                    console.log('Â∑≤‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÁêÉÂ±ÄÊï∞ÊçÆ');
                }
                
                // ÂàùÂßãÂåñÊó∂Èó¥Á±ªÂûãÂàáÊç¢ÂäüËÉΩ
                initializeTimeTypeToggle();
                
                // ÂàõÂª∫ÈªòËÆ§Áî®Êà∑Ôºà‰∏≠ÂõΩÁüø‰∏öÂ§ßÂ≠¶Ôºâ
                currentUser = {
                    studentId: '00000000',
                    name: 'ÈªòËÆ§Áî®Êà∑',
                    school: '‰∏≠ÂõΩÁüø‰∏öÂ§ßÂ≠¶'
                };
                
                // ‰øùÂ≠òÁî®Êà∑‰ø°ÊÅØÂà∞Êú¨Âú∞Â≠òÂÇ®
                localStorage.setItem('badmintonAuth', JSON.stringify(currentUser));
                
                console.log('ÂàõÂª∫ÈªòËÆ§Áî®Êà∑:', currentUser);
                
                // Ê£ÄÊü•ÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú® - ‰ΩøÁî®Ê≠£Á°ÆÁöÑÁ±ªÈÄâÊã©Âô®
                const mainContent = document.querySelector('.main-content');
                console.log('‰∏ªÂÜÖÂÆπÂÖÉÁ¥†:', mainContent);
                
                if (mainContent) {
                    // Áõ¥Êé•ÊòæÁ§∫‰∏ªÁïåÈù¢
                    mainContent.style.display = 'block';
                    console.log('ÊòæÁ§∫‰∏ªÁïåÈù¢');
                    
                    // Êõ¥Êñ∞Â≠¶Ê†°ÁïåÈù¢ÂíåÁî®Êà∑‰ø°ÊÅØ
                    updateSchoolInterface();
                    updateUserInfo();
                    console.log('ÁïåÈù¢‰ø°ÊÅØÊõ¥Êñ∞ÂÆåÊàê');
                    
                    // Á°Æ‰øùÁ≠õÈÄâÁä∂ÊÄÅ‰∏∫falseÔºåÁÑ∂ÂêéÁ´ãÂç≥Ê∏≤ÊüìÁêÉÂ±ÄÂàóË°®
                    isFiltered = false;
                    renderGames();
                    console.log('ÁêÉÂ±ÄÂàóË°®Ê∏≤ÊüìÂÆåÊàê');
                } else {
                    console.error('‰∏ªÂÜÖÂÆπÂÖÉÁ¥†Êú™ÊâæÂà∞');
                }
                
                // ÂàùÂßãÂåñ‰∏™‰∫∫‰ø°ÊÅØ
                const personalInfo = getPersonalInfo();
                const personalNameEl = document.getElementById('personalName');
                const personalRatingEl = document.getElementById('personalRating');
                const personalSchoolEl = document.getElementById('personalSchool');
                
                if (personalNameEl) {
                    personalNameEl.textContent = personalInfo.name;
                }
                if (personalRatingEl) {
                    personalRatingEl.textContent = personalInfo.rating + 'ÂàÜ';
                }
                if (personalSchoolEl) {
                    personalSchoolEl.textContent = personalInfo.school;
                }
                
                // ÂàùÂßãÂåñÂããÁ´†Á≥ªÁªü
                if (typeof initializeBadges === 'function') {
                    initializeBadges();
                }
                
                // ÊØè30ÁßíÊ£ÄÊü•‰∏ÄÊ¨°ÁêÉÂ±ÄÁä∂ÊÄÅÔºåÊõ¥Êñ∞Âç≥Â∞ÜÂºÄÂßãÁöÑÁêÉÂ±ÄÊòæÁ§∫
                setInterval(function() {
                    renderGames();
                }, 30000);
                
            } catch (error) {
                console.error('ÂàùÂßãÂåñËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØ:', error);
            }
        });

        // ÊòæÁ§∫‰∏ªÁïåÈù¢
        function showMainPage() {
            // ÂÖ≥Èó≠ÊâÄÊúâÂèØËÉΩÊâìÂºÄÁöÑÊ®°ÊÄÅÊ°Ü
            closeDetailModal();
            closeCreateModal();
            closeHistoryModal();
            closeFriendsModal();
            closePersonalInfoModal();
            closeFriendProfileModal();
            
            // Á°Æ‰øù‰∏ªÁïåÈù¢ÂÜÖÂÆπÂèØËßÅ
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                mainContent.style.display = 'block';
            }
            
            // Âà∑Êñ∞ÁêÉÂ±ÄÂàóË°®
            loadGames();
        }

        // ‰∏™‰∫∫‰ø°ÊÅØÊ®°ÊÄÅÊ°ÜÂäüËÉΩ
        function openProfileModal() {
            document.getElementById('profileModal').style.display = 'block';
            updateProfileDisplay();
        }

        function closeProfileModal() {
            document.getElementById('profileModal').style.display = 'none';
        }

        // ÊéíË°åÊ¶úÈ°µÈù¢ÂäüËÉΩ
        function openRankingPage() {
            window.open('ranking.html', '_blank');
        }

        function updateProfileDisplay() {
            if (currentUser) {
                document.getElementById('profileAvatar').textContent = 'üë§';
                document.getElementById('profileName').textContent = `Â≠¶Áîü ${currentUser.studentId}`;
                document.getElementById('profileSchool').textContent = currentUser.school;
                document.getElementById('profileStudentId').textContent = currentUser.studentId;
            } else {
                document.getElementById('profileAvatar').textContent = 'üë§';
                document.getElementById('profileName').textContent = 'Êú™ËÆ§ËØÅÁî®Êà∑';
                document.getElementById('profileSchool').textContent = 'ËØ∑ÂÖàÂÆåÊàêËÆ§ËØÅ';
                document.getElementById('profileStudentId').textContent = 'Êó†';
            }
        }

        function updateUserInfo() {
            const userAvatarEl = document.getElementById('userAvatar');
            const userNameEl = document.getElementById('userName');
            const userSchoolEl = document.getElementById('userSchool');
            
            if (currentUser) {
                if (userAvatarEl) userAvatarEl.textContent = 'üë§';
                if (userNameEl) userNameEl.textContent = `Â≠¶Áîü ${currentUser.studentId}`;
                if (userSchoolEl) userSchoolEl.textContent = currentUser.school;
            } else {
                if (userAvatarEl) userAvatarEl.textContent = 'üë§';
                if (userNameEl) userNameEl.textContent = 'Êú™ËÆ§ËØÅÁî®Êà∑';
                if (userSchoolEl) userSchoolEl.textContent = 'ËØ∑ÂÖàÂÆåÊàêËÆ§ËØÅ';
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('badmintonAuth');
            
            // ÂàáÊç¢Âà∞ËÆ§ËØÅÁïåÈù¢
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('mainContent').style.display = 'none';
            
            // Ê∏ÖÁ©∫Ë°®Âçï
            document.getElementById('authForm').reset();
            
            closeProfileModal();
        }

        // ËßÜÈ¢ëÊí≠ÊîæÂäüËÉΩ
        function openVideoModal(videoName, gameId) {
            const game = games.find(g => g.id === gameId);
            if (!game) return;
            
            // ËÆæÁΩÆËßÜÈ¢ëÊ®°ÊÄÅÊ°ÜÂÜÖÂÆπ
            document.getElementById('videoModalTitle').textContent = 'ËßÜÈ¢ëÈ¢ÑËßà - ' + videoName;
            document.getElementById('videoFileName').textContent = videoName;
            document.getElementById('videoGameTitle').textContent = game.title;
            document.getElementById('videoOrganizerName').textContent = game.organizer ? game.organizer.name : 'Êú™Áü•';
            document.getElementById('videoGameLevel').textContent = game.level;
            
            // ÊòæÁ§∫ËßÜÈ¢ëÊ®°ÊÄÅÊ°Ü
            const modal = document.getElementById('videoModal');
            if (modal) {
                modal.style.display = 'block';
                modal.style.animation = 'fadeIn 0.3s ease';
            }
        }

        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
        window.addEventListener('click', function(e) {
            const createModal = document.getElementById('createModal');
            const detailModal = document.getElementById('detailModal');
            const profileModal = document.getElementById('profileModal');
            const videoModal = document.getElementById('videoModal');
            
            if (e.target === createModal) {
                closeCreateModal();
            }
            
            if (e.target === detailModal) {
                closeDetailModal();
            }
            
            if (e.target === profileModal) {
                closeProfileModal();
            }
            
            if (e.target === videoModal) {
                closeVideoModal();
            }
        });

        // ËÅäÂ§©ÂäüËÉΩÁõ∏ÂÖ≥ÂèòÈáèÂíåÂáΩÊï∞
        let chatMessages = {}; // Â≠òÂÇ®ÊØè‰∏™ÁêÉÂ±ÄÁöÑËÅäÂ§©ËÆ∞ÂΩï
        let currentChatGameId = null;

        // ÊâìÂºÄËÅäÂ§©Ê®°ÊÄÅÊ°Ü
        function openChatModal() {
            if (!currentGameId) {
                alert('ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™ÁêÉÂ±Ä');
                return;
            }

            if (!currentUser || !currentUser.studentId) {
                alert('ËØ∑ÂÖàÂÆåÊàêËÆ§ËØÅÂêéÂÜç‰ΩøÁî®ËÅäÂ§©ÂäüËÉΩ');
                return;
            }

            currentChatGameId = currentGameId;
            const game = games.find(g => g.id === currentGameId);
            
            if (game) {
                document.getElementById('chatTitle').textContent = `${game.title} - ËÅäÂ§©ÂÆ§`;
            }

            // Âä†ËΩΩËÅäÂ§©ËÆ∞ÂΩï
            loadChatMessages();
            
            document.getElementById('chatModal').style.display = 'block';
            document.getElementById('chatInput').focus();
        }

        // ÂÖ≥Èó≠ËÅäÂ§©Ê®°ÊÄÅÊ°Ü
        function closeChatModal() {
            document.getElementById('chatModal').style.display = 'none';
            currentChatGameId = null;
        }

        // Âä†ËΩΩËÅäÂ§©ËÆ∞ÂΩï
        function loadChatMessages() {
            if (!currentChatGameId) return;

            const messagesContainer = document.getElementById('chatMessages');
            const gameMessages = chatMessages[currentChatGameId] || [];

            if (gameMessages.length === 0) {
                messagesContainer.innerHTML = `
                    <div class="empty-chat">
                        <div class="empty-chat-icon">üí¨</div>
                        <p>ËøòÊ≤°ÊúâÊ∂àÊÅØÔºåÂºÄÂßãËÅäÂ§©ÂêßÔºÅ</p>
                    </div>
                `;
            } else {
                messagesContainer.innerHTML = gameMessages.map(msg => createMessageHTML(msg)).join('');
                // ÊªöÂä®Âà∞Â∫ïÈÉ®
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }

        // ÂàõÂª∫Ê∂àÊÅØHTML
        function createMessageHTML(message) {
            const isOwn = message.userId === currentUser.studentId;
            const messageClass = isOwn ? 'message own' : 'message';
            
            return `
                <div class="${messageClass}">
                    <div class="message-avatar">${message.avatar}</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            ${escapeHtml(message.text)}
                        </div>
                        <div class="message-info">
                            <span>${message.userName}</span>
                            <span>‚Ä¢</span>
                            <span>${formatTime(message.timestamp)}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // ÂèëÈÄÅÊ∂àÊÅØ
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();

            if (!text) return;
            if (!currentChatGameId) return;
            if (!currentUser || !currentUser.studentId) {
                alert('ËØ∑ÂÖàÂÆåÊàêËÆ§ËØÅ');
                return;
            }

            const message = {
                id: Date.now(),
                userId: currentUser.studentId,
                userName: `Â≠¶Áîü ${currentUser.studentId}`,
                avatar: 'üë§',
                text: text,
                timestamp: new Date(),
                gameId: currentChatGameId
            };

            // Ê∑ªÂä†Âà∞ËÅäÂ§©ËÆ∞ÂΩï
            if (!chatMessages[currentChatGameId]) {
                chatMessages[currentChatGameId] = [];
            }
            chatMessages[currentChatGameId].push(message);

            // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
            saveChatMessages();

            // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
            input.value = '';
            
            // ÈáçÊñ∞Âä†ËΩΩÊ∂àÊÅØÊòæÁ§∫
            loadChatMessages();
        }

        // Â§ÑÁêÜÈîÆÁõò‰∫ã‰ª∂
        function handleChatKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Âà†Èô§ÁêÉÂ±ÄÂäüËÉΩ
        function deleteGame() {
            if (!currentGameId) {
                alert('Êú™ÈÄâÊã©ÁêÉÂ±Ä');
                return;
            }

            const game = games.find(g => g.id === currentGameId);
            if (!game) {
                alert('ÁêÉÂ±Ä‰∏çÂ≠òÂú®');
                return;
            }

            // Á°ÆËÆ§Âà†Èô§
            if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÁêÉÂ±Ä"${game.title}"ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ`)) {
                return;
            }

            // ‰ªégamesÊï∞ÁªÑ‰∏≠Âà†Èô§
            const gameIndex = games.findIndex(g => g.id === currentGameId);
            if (gameIndex !== -1) {
                games.splice(gameIndex, 1);
            }

            // ‰ªéschoolGames‰∏≠Âà†Èô§
            if (currentUser && schoolGames[currentUser.school]) {
                const schoolGameIndex = schoolGames[currentUser.school].findIndex(g => g.id === currentGameId);
                if (schoolGameIndex !== -1) {
                    schoolGames[currentUser.school].splice(schoolGameIndex, 1);
                }
            }

            // Âà†Èô§Áõ∏ÂÖ≥ËÅäÂ§©ËÆ∞ÂΩï
            if (chatMessages[currentGameId]) {
                delete chatMessages[currentGameId];
                saveChatMessages();
            }

            // ‰øùÂ≠òÊõ¥Êñ∞ÂêéÁöÑÁêÉÂ±ÄÊï∞ÊçÆ
            saveGamesToStorage();

            // ÂÖ≥Èó≠ËØ¶ÊÉÖÈ°µ
            closeDetailModal();

            // ÈáçÊñ∞Ê∏≤ÊüìÁêÉÂ±ÄÂàóË°®
            renderGames();

            // ÊòæÁ§∫ÊàêÂäüÊèêÁ§∫
            alert('ÁêÉÂ±ÄÂà†Èô§ÊàêÂäüÔºÅ');
        }

        // ‰øùÂ≠òËÅäÂ§©ËÆ∞ÂΩïÂà∞Êú¨Âú∞Â≠òÂÇ®
        function saveChatMessages() {
            try {
                localStorage.setItem('badminton_chat_messages', JSON.stringify(chatMessages));
            } catch (error) {
                console.error('‰øùÂ≠òËÅäÂ§©ËÆ∞ÂΩïÂ§±Ë¥•:', error);
            }
        }

        // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩËÅäÂ§©ËÆ∞ÂΩï
        function loadChatMessagesFromStorage() {
            try {
                const stored = localStorage.getItem('badminton_chat_messages');
                if (stored) {
                    chatMessages = JSON.parse(stored);
                }
            } catch (error) {
                console.error('Âä†ËΩΩËÅäÂ§©ËÆ∞ÂΩïÂ§±Ë¥•:', error);
                chatMessages = {};
            }
        }

        // ‰øùÂ≠òÁêÉÂ±ÄÊï∞ÊçÆÂà∞Êú¨Âú∞Â≠òÂÇ®
        function saveGamesToStorage() {
            try {
                localStorage.setItem('badminton_games', JSON.stringify(games));
                console.log('ÁêÉÂ±ÄÊï∞ÊçÆÂ∑≤‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®');
            } catch (error) {
                console.error('‰øùÂ≠òÁêÉÂ±ÄÊï∞ÊçÆÂ§±Ë¥•:', error);
            }
        }

        // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÁêÉÂ±ÄÊï∞ÊçÆ
        function loadGamesFromStorage() {
            try {
                const stored = localStorage.getItem('badminton_games');
                if (stored) {
                    const loadedGames = JSON.parse(stored);
                    if (loadedGames && loadedGames.length > 0) {
                        games = loadedGames;
                        console.log('‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩ‰∫Ü', games.length, '‰∏™ÁêÉÂ±Ä');
                        return true;
                    }
                }
            } catch (error) {
                console.error('Âä†ËΩΩÁêÉÂ±ÄÊï∞ÊçÆÂ§±Ë¥•:', error);
            }
            return false;
        }

        // ËΩ¨‰πâHTMLÂ≠óÁ¨¶
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Ê†ºÂºèÂåñÊó∂Èó¥
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;

            if (diff < 60000) { // 1ÂàÜÈíüÂÜÖ
                return 'ÂàöÂàö';
            } else if (diff < 3600000) { // 1Â∞èÊó∂ÂÜÖ
                return `${Math.floor(diff / 60000)}ÂàÜÈíüÂâç`;
            } else if (date.toDateString() === now.toDateString()) { // ‰ªäÂ§©
                return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            } else {
                return date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' }) + ' ' + 
                       date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            }
        }

        // ‰∏™‰∫∫‰ø°ÊÅØÊ®°ÊÄÅÊ°ÜÂäüËÉΩ
        function openPersonalInfoModal() {
            const modal = document.getElementById('personalInfoModal');
            modal.style.display = 'block';
            
            // Âä†ËΩΩÂΩìÂâç‰∏™‰∫∫‰ø°ÊÅØÂà∞ÁºñËæëÊ°Ü
            const personalInfo = getPersonalInfo();
            document.getElementById('editPersonalName').value = personalInfo.name;
            document.getElementById('editPersonalRating').value = personalInfo.rating;
            document.getElementById('editPersonalGender').value = personalInfo.gender || '';
            document.getElementById('editPersonalAge').value = personalInfo.age || '';
            document.getElementById('editPersonalBirthday').value = personalInfo.birthday || '';
            document.getElementById('editPersonalSignature').value = personalInfo.signature || '';
            
            // Âä†ËΩΩÂ§¥ÂÉèÈ¢ÑËßà
            if (personalInfo.avatar) {
                const preview = document.getElementById('avatarPreview');
                const previewImg = preview.querySelector('img');
                previewImg.src = personalInfo.avatar;
                preview.style.display = 'block';
            } else {
                document.getElementById('avatarPreview').style.display = 'none';
            }
            
            // Êõ¥Êñ∞Â§¥ÂÉèÊòæÁ§∫
            updateAvatarDisplay();
        }

        function closePersonalInfoModal() {
            const modal = document.getElementById('personalInfoModal');
            modal.style.display = 'none';
        }

        function logout() {
            if (confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü')) {
                // Ê∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®ÁöÑÁî®Êà∑‰ø°ÊÅØ
                localStorage.removeItem('currentUser');
                localStorage.removeItem('personalInfo');
                localStorage.removeItem('gameHistory');
                localStorage.removeItem('friends');
                
                // Ë∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢
                window.location.href = 'login.html';
            }
        }

        function getPersonalInfo() {
            // ‰ªéÊú¨Âú∞Â≠òÂÇ®Ëé∑Âèñ‰∏™‰∫∫‰ø°ÊÅØÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàôËøîÂõûÈªòËÆ§ÂÄº
            const saved = localStorage.getItem('personalInfo');
            if (saved) {
                return JSON.parse(saved);
            }
            return {
                name: 'Âº†‰∏â',
                rating: '8.5',
                gender: '',
                age: '',
                birthday: '',
                signature: ''
            };
        }

        function savePersonalInfo() {
            const name = document.getElementById('editPersonalName').value.trim();
            const rating = getPersonalInfo().rating; // ‰ΩøÁî®Áé∞ÊúâËØÑÂàÜÔºå‰∏çÂÖÅËÆ∏‰øÆÊîπ
            const gender = document.getElementById('editPersonalGender').value;
            const age = document.getElementById('editPersonalAge').value;
            const birthday = document.getElementById('editPersonalBirthday').value;
            const signature = document.getElementById('editPersonalSignature').value.trim();

            if (!name) {
                alert('ËØ∑Â°´ÂÜôÂßìÂêç');
                return;
            }

            const personalInfo = {
                name: name,
                rating: rating,
                gender: gender,
                age: age,
                birthday: birthday,
                signature: signature
            };

            // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
            localStorage.setItem('personalInfo', JSON.stringify(personalInfo));

            // Êõ¥Êñ∞ÊòæÁ§∫
            document.getElementById('personalName').textContent = name;
            document.getElementById('personalRating').textContent = rating + 'ÂàÜ';
            document.getElementById('personalGender').textContent = gender || 'Êú™ËÆæÁΩÆ';
            document.getElementById('personalAge').textContent = age ? age + 'Â≤Å' : 'Êú™ËÆæÁΩÆ';
            document.getElementById('personalBirthday').textContent = birthday || 'Êú™ËÆæÁΩÆ';
            document.getElementById('personalSignature').textContent = signature || 'Êú™ËÆæÁΩÆ';

            alert('‰∏™‰∫∫‰ø°ÊÅØ‰øùÂ≠òÊàêÂäüÔºÅ');
            closePersonalInfoModal();
        }

        // Â•ΩÂèãÊ®°ÊÄÅÊ°ÜÂäüËÉΩ
        function openFriendsModal() {
            const modal = document.getElementById('friendsModal');
            modal.style.display = 'block';
        }

        function closeFriendsModal() {
            const modal = document.getElementById('friendsModal');
            modal.style.display = 'none';
        }

        // ÂéÜÂè≤ÁêÉÂ±ÄÊ®°ÊÄÅÊ°ÜÂäüËÉΩ
        function openHistoryModal() {
            const modal = document.getElementById('historyModal');
            loadHistoryGames();
            updateHistoryStats();
            modal.style.display = 'block';
        }

        function closeHistoryModal() {
            const modal = document.getElementById('historyModal');
            modal.style.display = 'none';
        }

        function loadHistoryGames() {
            const historyList = document.getElementById('historyGamesList');
            
            // ‰ªélocalStorageËé∑ÂèñÂéÜÂè≤ÁêÉÂ±ÄÊï∞ÊçÆ
            const historyGames = JSON.parse(localStorage.getItem('historyGames') || '[]');
            
            if (historyGames.length === 0) {
                historyList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <div style="font-size: 3rem; margin-bottom: 20px;">üè∏</div>
                        <p>ÊöÇÊó†ÂéÜÂè≤ÁêÉÂ±ÄËÆ∞ÂΩï</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">ÂèÇ‰∏éÁêÉÂ±ÄÂêéÔºåËÆ∞ÂΩï‰ºöÊòæÁ§∫Âú®ËøôÈáå</p>
                    </div>
                `;
                return;
            }

            // ÊåâÁªìÁÆóÊó∂Èó¥ÂÄíÂ∫èÊéíÂàó
            historyGames.sort((a, b) => {
                const timeA = a.settlementData ? new Date(a.settlementData.settlementTime) : new Date(a.date || 0);
                const timeB = b.settlementData ? new Date(b.settlementData.settlementTime) : new Date(b.date || 0);
                return timeB - timeA;
            });

            historyList.innerHTML = historyGames.map(game => `
                <div class="history-game-item" onclick="viewHistoryGameDetail('${game.id}')">
                    <div class="history-game-icon">üè∏</div>
                    <div class="history-game-info">
                        <div class="history-game-title">${game.title}</div>
                        <div class="history-game-details">
                            <div class="detail-row">
                                <span class="detail-icon">‚è∞</span>
                                <span>${game.time}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-icon">üìç</span>
                                <span>${game.location}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-icon">üë•</span>
                                <span>${game.players}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-icon">üè∏</span>
                                <span>${game.shuttlecockName} - ${game.shuttlecockPrice}ÂÖÉ</span>
                            </div>
                            ${game.settlementData ? `
                            <div class="detail-row settlement-info">
                                <span class="detail-icon">üí∞</span>
                                <span>‰∫∫ÂùáË¥πÁî®: ¬•${game.settlementData.perPersonCost.toFixed(2)}</span>
                            </div>
                            ` : ''}
                        </div>
                        <div class="history-game-date">
                            ${game.settlementData ? 
                                formatDate(game.settlementData.settlementTime) : 
                                formatDate(game.date || new Date().toISOString())
                            }
                        </div>
                        <div class="history-game-status">
                            ${game.isSettled ? 'Â∑≤ÁªìÁÆó' : (game.status === 'completed' ? 'Â∑≤ÂÆåÊàê' : 'ËøõË°å‰∏≠')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateHistoryStats() {
            const historyGames = JSON.parse(localStorage.getItem('historyGames') || '[]');
            
            // ËÆ°ÁÆóÊÄªÂèÇ‰∏éÊ¨°Êï∞
            document.getElementById('totalGamesCount').textContent = historyGames.length;
            
            // ËÆ°ÁÆóÊÄªËøêÂä®Êó∂Èïø
            let totalHours = 0;
            historyGames.forEach(game => {
                if (game.settlementData && game.settlementData.duration) {
                    // Â¶ÇÊûúÊúâÁªìÁÆóÊï∞ÊçÆ‰∏≠ÁöÑÂÆûÈôÖÊó∂ÈïøÔºå‰ΩøÁî®ÂÆûÈôÖÊó∂Èïø
                    totalHours += game.settlementData.duration;
                } else {
                    // Âê¶ÂàôÂÅáËÆæÊØèÂ±Ä2Â∞èÊó∂
                    totalHours += 2;
                }
            });
            document.getElementById('totalPlayTime').textContent = totalHours + 'Â∞èÊó∂';
            
            // ËÆ°ÁÆóÊÄªÊ∂àË¥πÈáëÈ¢ù
            let totalCost = 0;
            historyGames.forEach(game => {
                if (game.settlementData && game.settlementData.perPersonCost) {
                    // Â¶ÇÊûúÊúâÁªìÁÆóÊï∞ÊçÆÔºå‰ΩøÁî®‰∫∫ÂùáË¥πÁî®
                    totalCost += game.settlementData.perPersonCost;
                } else if (game.cost) {
                    // Âê¶Âàô‰ΩøÁî®ÂéüÊúâÁöÑcostÂ≠óÊÆµ
                    totalCost += game.cost;
                }
            });
            document.getElementById('totalCost').textContent = '¬•' + totalCost.toFixed(2);
        }

        function viewHistoryGameDetail(gameId) {
            const historyGames = JSON.parse(localStorage.getItem('historyGames') || '[]');
            const game = historyGames.find(g => g.id === gameId);
            
            if (!game) {
                alert('Êú™ÊâæÂà∞ËØ•ÁêÉÂ±Ä‰ø°ÊÅØ');
                return;
            }

            // ÂàõÂª∫ËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
                    <div class="modal-header">
                        <h2>ÁêÉÂ±ÄËØ¶ÊÉÖ</h2>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="game-detail-section">
                            <h3>Âü∫Êú¨‰ø°ÊÅØ</h3>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <span class="detail-label">ÁêÉÂ±ÄÊ†áÈ¢òÔºö</span>
                                    <span class="detail-value">${game.title}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ê∞¥Âπ≥Á≠âÁ∫ßÔºö</span>
                                    <span class="detail-value">${game.level}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Êó∂Èó¥Ôºö</span>
                                    <span class="detail-value">${game.time}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Âú∞ÁÇπÔºö</span>
                                    <span class="detail-value">${game.location}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÂèÇ‰∏é‰∫∫Êï∞Ôºö</span>
                                    <span class="detail-value">${game.players}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÁæΩÊØõÁêÉÔºö</span>
                                    <span class="detail-value">${game.shuttlecockName} - ${game.shuttlecockPrice}ÂÖÉ</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÁªÑÁªáËÄÖÔºö</span>
                                    <span class="detail-value">${game.organizer} (${game.organizerRating}ÂàÜ)</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ËÅîÁ≥ªÊñπÂºèÔºö</span>
                                    <span class="detail-value">${game.contact}</span>
                                </div>
                            </div>
                        </div>
                        
                        ${game.settlementData ? `
                        <div class="game-detail-section">
                            <h3>ÁªìÁÆó‰ø°ÊÅØ</h3>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <span class="detail-label">Âú∫Âú∞Ë¥πÁî®Ôºö</span>
                                    <span class="detail-value">¬•${game.settlementData.venueCost.toFixed(2)}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÁêÉË¥πÔºö</span>
                                    <span class="detail-value">¬•${game.settlementData.shuttlecockCost.toFixed(2)}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÊÄªË¥πÁî®Ôºö</span>
                                    <span class="detail-value">¬•${game.settlementData.totalCost.toFixed(2)}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÂÆûÂà∞‰∫∫Êï∞Ôºö</span>
                                    <span class="detail-value">${game.settlementData.actualAttendance}‰∫∫</span>
                                </div>
                                <div class="detail-item highlight">
                                    <span class="detail-label">‰∫∫ÂùáË¥πÁî®Ôºö</span>
                                    <span class="detail-value">¬•${game.settlementData.perPersonCost.toFixed(2)}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÁªìÁÆóÊó∂Èó¥Ôºö</span>
                                    <span class="detail-value">${formatDate(game.settlementData.settlementTime)}</span>
                                </div>
                            </div>
                        </div>
                        ` : `
                        <div class="game-detail-section">
                            <p style="text-align: center; color: #666; padding: 20px;">ËØ•ÁêÉÂ±ÄÂ∞öÊú™ÁªìÁÆó</p>
                        </div>
                        `}
                    </div>
                    <div class="modal-footer" style="padding: 20px; border-top: 1px solid #eee; text-align: center;">
                        <button class="rating-btn" onclick="openPostGameRating('${game.id}')" style="
                            background: white;
                            color: #333;
                            border: 1px solid #ddd;
                            padding: 12px 30px;
                            border-radius: 25px;
                            font-size: 16px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(78, 205, 196, 0.4)'" 
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(78, 205, 196, 0.3)'">
                            ‚≠ê ËµõÂêéËØÑÂàÜ
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) {
                return 'Êò®Â§©';
            } else if (diffDays <= 7) {
                return diffDays + 'Â§©Ââç';
            } else {
                return date.toLocaleDateString('zh-CN');
            }
        }

        // ÊâìÂºÄËµõÂêéËØÑ‰ª∑È°µÈù¢
        function openPostGameRating(gameId) {
            // Ë∑≥ËΩ¨Âà∞ËµõÂêéËØÑ‰ª∑È°µÈù¢ÔºåÂπ∂‰º†ÈÄíÁêÉÂ±ÄIDÂèÇÊï∞
            window.open(`post-game-rating.html?gameId=${gameId}`, '_blank');
        }

        function searchFriend() {
            const searchTerm = document.getElementById('searchFriend').value.trim();
            if (!searchTerm) {
                alert('ËØ∑ËæìÂÖ•ÊêúÁ¥¢ÂÜÖÂÆπ');
                return;
            }
            
            // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ÂÆûÈôÖÁöÑÊêúÁ¥¢ÈÄªËæë
            alert('ÊêúÁ¥¢ÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠ÔºåÊêúÁ¥¢ÂÜÖÂÆπÔºö' + searchTerm);
        }

        // Â•ΩÂèã‰∏™‰∫∫‰∏ªÈ°µÂäüËÉΩ
        function openFriendProfile(name, school, rating, badges) {
            const modal = document.getElementById('friendProfileModal');
            
            // ËÆæÁΩÆÂ•ΩÂèã‰ø°ÊÅØ
            document.getElementById('friendProfileName').textContent = name;
            document.getElementById('friendProfileRating').textContent = rating + 'ÂàÜ';
            document.getElementById('friendProfileSchool').textContent = school;
            document.getElementById('friendProfileTitle').textContent = name + ' ÁöÑ‰∏™‰∫∫‰∏ªÈ°µ';
            
            // Êõ¥Êñ∞ÂããÁ´†ÊòæÁ§∫
            updateFriendBadges(badges);
            
            modal.style.display = 'block';
        }

        function closeFriendProfileModal() {
            const modal = document.getElementById('friendProfileModal');
            modal.style.display = 'none';
        }

        function updateFriendBadges(earnedBadges) {
            const badgeItems = document.querySelectorAll('#friendBadgesContainer .badge-item');
            
            badgeItems.forEach(item => {
                const badgeType = item.getAttribute('data-badge');
                if (earnedBadges.includes(badgeType)) {
                    item.classList.add('earned');
                } else {
                    item.classList.remove('earned');
                }
            });
        }

        function inviteFriend(friendName) {
            alert('Â∑≤Âêë ' + friendName + ' ÂèëÈÄÅÈÇÄËØ∑ÔºÅ');
        }

        function inviteFriendFromProfile() {
            const friendName = document.getElementById('friendProfileName').textContent;
            alert('Â∑≤Âêë ' + friendName + ' ÂèëÈÄÅÈÇÄËØ∑ÔºÅ');
            closeFriendProfileModal();
        }

        function sendMessageToFriend() {
            const friendName = document.getElementById('friendProfileName').textContent;
            alert('Ê∂àÊÅØÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠ÔºåÂ∞ÜÂêë ' + friendName + ' ÂèëÈÄÅÊ∂àÊÅØ');
        }

        // ÂããÁ´†Á≥ªÁªüÈÄªËæë
        function initializeBadges() {
            const savedBadges = localStorage.getItem('userBadges');
            let earnedBadges = [];
            
            if (savedBadges) {
                earnedBadges = JSON.parse(savedBadges);
            } else {
                // ÈªòËÆ§ÁªôÁî®Êà∑‰∏Ä‰∏™Á†¥ÂÜ∞Ëææ‰∫∫ÂããÁ´†
                earnedBadges = ['icebreaker'];
                localStorage.setItem('userBadges', JSON.stringify(earnedBadges));
            }
            
            updateUserBadges(earnedBadges);
        }

        function updateUserBadges(earnedBadges) {
            const badgeItems = document.querySelectorAll('#badgesContainer .badge-item');
            
            badgeItems.forEach(item => {
                const badgeType = item.getAttribute('data-badge');
                if (earnedBadges.includes(badgeType)) {
                    item.classList.add('earned');
                } else {
                    item.classList.remove('earned');
                }
            });
        }

        function checkAndAwardBadges() {
            const savedBadges = localStorage.getItem('userBadges');
            let earnedBadges = savedBadges ? JSON.parse(savedBadges) : ['icebreaker'];
            let newBadges = [];
            
            // Á†¥ÂÜ∞Ëææ‰∫∫ÔºöÈ¶ñÊ¨°‰ΩøÁî®Â∫îÁî®ÔºàÈªòËÆ§Ëé∑ÂæóÔºâ
            if (!earnedBadges.includes('icebreaker')) {
                earnedBadges.push('icebreaker');
                newBadges.push('Á†¥ÂÜ∞Ëææ‰∫∫');
            }
            
            // Á§æ‰∫§Ëææ‰∫∫ÔºöÂàõÂª∫ÊàñÂèÇÂä†3‰∏™‰ª•‰∏äÁêÉÂ±Ä
            const gameCount = games.length;
            if (gameCount >= 3 && !earnedBadges.includes('social')) {
                earnedBadges.push('social');
                newBadges.push('Á§æ‰∫§Ëææ‰∫∫');
            }
            
            // ÂÆàÊó∂‰πãÊòüÔºöËøûÁª≠5Ê¨°ÂáÜÊó∂ÂèÇÂä†ÁêÉÂ±ÄÔºàÊ®°ÊãüÈÄªËæëÔºâ
            const punctualityCount = localStorage.getItem('punctualityCount') || 0;
            if (punctualityCount >= 5 && !earnedBadges.includes('punctual')) {
                earnedBadges.push('punctual');
                newBadges.push('ÂÆàÊó∂‰πãÊòü');
            }
            
            // ‰øùÂ≠òÊõ¥Êñ∞ÁöÑÂããÁ´†
            localStorage.setItem('userBadges', JSON.stringify(earnedBadges));
            updateUserBadges(earnedBadges);
            
            // ÊòæÁ§∫Êñ∞Ëé∑ÂæóÁöÑÂããÁ´†
            if (newBadges.length > 0) {
                alert('üéâ ÊÅ≠ÂñúËé∑ÂæóÊñ∞ÂããÁ´†Ôºö' + newBadges.join('„ÄÅ') + 'ÔºÅ');
            }
        }

        // Â¢ûÂä†ÂáÜÊó∂ËÆ∞ÂΩïÔºàÂú®ÂèÇÂä†ÁêÉÂ±ÄÊó∂Ë∞ÉÁî®Ôºâ
        function addPunctualityRecord() {
            let punctualityCount = parseInt(localStorage.getItem('punctualityCount') || 0);
            punctualityCount++;
            localStorage.setItem('punctualityCount', punctualityCount.toString());
            checkAndAwardBadges();
        }

        // ÂàùÂßãÂåñÊó∂Èó¥Á±ªÂûãÂàáÊç¢ÂäüËÉΩ
        function initializeTimeTypeToggle() {
            const timeTypeRadios = document.querySelectorAll('input[name="timeType"]');
            const temporarySettings = document.getElementById('temporaryTimeSettings');
            const weeklySettings = document.getElementById('weeklyTimeSettings');
            
            timeTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'temporary') {
                        temporarySettings.style.display = 'block';
                        weeklySettings.style.display = 'none';
                    } else if (this.value === 'weekly') {
                        temporarySettings.style.display = 'none';
                        weeklySettings.style.display = 'block';
                    }
                });
            });
        }

        // ÂàõÂª∫ÁêÉÂ±ÄÊó∂Ê£ÄÊü•ÂããÁ´†
        function createGame() {
            // Ëøô‰∏™ÂáΩÊï∞Â∑≤Ë¢´Ë°®ÂçïÊèê‰∫§Â§ÑÁêÜÂô®Êõø‰ª£
            // ÂããÁ´†Ê£ÄÊü•ÈÄªËæëÂ∑≤ÈõÜÊàêÂà∞Ë°®ÂçïÊèê‰∫§Â§ÑÁêÜ‰∏≠
        }

        // ÂèÇÂä†ÁêÉÂ±ÄÊó∂Ê£ÄÊü•ÂããÁ´†
        function joinGame() {
            // Ëøô‰∏™ÂáΩÊï∞Â∑≤Ë¢´‰∏äÈù¢ÁöÑjoinGameÂáΩÊï∞Êõø‰ª£
            // ÂããÁ´†Ê£ÄÊü•ÈÄªËæëÂ∑≤ÈõÜÊàêÂà∞ÂèÇÂä†ÁêÉÂ±ÄÂäüËÉΩ‰∏≠
        }

        // Â§¥ÂÉèÂ§ÑÁêÜÂäüËÉΩ
        function selectAvatar() {
            document.getElementById('avatarInput').click();
        }

        function handleAvatarChange(event) {
            const file = event.target.files[0];
            if (file) {
                // È™åËØÅÊñá‰ª∂Á±ªÂûã
                if (!file.type.startsWith('image/')) {
                    alert('ËØ∑ÈÄâÊã©ÂõæÁâáÊñá‰ª∂ÔºÅ');
                    return;
                }

                // È™åËØÅÊñá‰ª∂Â§ßÂ∞èÔºàÈôêÂà∂‰∏∫2MBÔºâ
                if (file.size > 2 * 1024 * 1024) {
                    alert('ÂõæÁâáÊñá‰ª∂Â§ßÂ∞è‰∏çËÉΩË∂ÖËøá2MBÔºÅ');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const avatarData = e.target.result;
                    
                    // ÊòæÁ§∫È¢ÑËßà
                    const preview = document.getElementById('avatarPreview');
                    const previewImg = preview.querySelector('img');
                    previewImg.src = avatarData;
                    preview.style.display = 'block';
                    
                    // ‰øùÂ≠òÂ§¥ÂÉèÊï∞ÊçÆÂà∞Êú¨Âú∞Â≠òÂÇ®
                    const personalInfo = getPersonalInfo();
                    personalInfo.avatar = avatarData;
                    localStorage.setItem('personalInfo', JSON.stringify(personalInfo));
                    
                    // Êõ¥Êñ∞ÊòæÁ§∫Âå∫ÂüüÁöÑÂ§¥ÂÉè
                    updateAvatarDisplay();
                };
                reader.readAsDataURL(file);
            }
        }

        function removeAvatar() {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Â§¥ÂÉèÂêóÔºü')) {
                // Ê∏ÖÈô§È¢ÑËßà
                const preview = document.getElementById('avatarPreview');
                preview.style.display = 'none';
                
                // Ê∏ÖÈô§Êñá‰ª∂ËæìÂÖ•
                document.getElementById('avatarInput').value = '';
                
                // ‰ªéÊú¨Âú∞Â≠òÂÇ®‰∏≠Âà†Èô§Â§¥ÂÉè
                const personalInfo = getPersonalInfo();
                delete personalInfo.avatar;
                localStorage.setItem('personalInfo', JSON.stringify(personalInfo));
                
                // Êõ¥Êñ∞ÊòæÁ§∫Âå∫ÂüüÁöÑÂ§¥ÂÉè
                updateAvatarDisplay();
            }
        }

        function updateAvatarDisplay() {
            const personalInfo = getPersonalInfo();
            const avatarImage = document.getElementById('avatarImage');
            const avatarPlaceholder = document.getElementById('avatarPlaceholder');
            
            if (personalInfo.avatar) {
                avatarImage.src = personalInfo.avatar;
                avatarImage.style.display = 'block';
                avatarPlaceholder.style.display = 'none';
            } else {
                avatarImage.style.display = 'none';
                avatarPlaceholder.style.display = 'flex';
            }
        }

        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ‰∏™‰∫∫‰ø°ÊÅØ - Â∑≤ÂêàÂπ∂Âà∞‰∏äÈù¢ÁöÑ‰∏ªDOMContentLoaded‰∫ã‰ª∂‰∏≠

        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
        window.onclick = function(event) {
            const personalModal = document.getElementById('personalInfoModal');
            const friendsModal = document.getElementById('friendsModal');
            const friendProfileModal = document.getElementById('friendProfileModal');
            
            if (event.target === personalModal) {
                closePersonalInfoModal();
            }
            if (event.target === friendsModal) {
                closeFriendsModal();
            }
            if (event.target === friendProfileModal) {
                closeFriendProfileModal();
            }
        }

    </script>

    <!-- ‰∏™‰∫∫‰ø°ÊÅØÊ®°ÊÄÅÊ°Ü -->
    <div id="profileModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">‰∏™‰∫∫‰ø°ÊÅØ</h2>
                <button class="close-btn" onclick="closeProfileModal()">&times;</button>
            </div>
            <div class="modal-body" style="text-align: center; padding: 30px;">
                <div class="profile-avatar" style="font-size: 80px; margin-bottom: 20px;">
                    <span id="profileAvatar">üë§</span>
                </div>
                <div class="profile-info" style="margin-bottom: 30px;">
                    <h3 id="profileName" style="margin-bottom: 10px;">Êú™ËÆ§ËØÅÁî®Êà∑</h3>
                    <p id="profileSchool" style="color: #666; margin-bottom: 5px;">ËØ∑ÂÖàÂÆåÊàêËÆ§ËØÅ</p>
                    <p id="profileStudentId" style="color: #999; font-size: 14px;">Â≠¶Âè∑ÔºöÊó†</p>
                </div>
                <div class="ranking-section" style="margin-bottom: 20px;">
                    <button class="ranking-btn" onclick="openRankingPage()" style="width: 100%; padding: 12px 20px; background: white; color: #333; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; cursor: pointer; transition: all 0.3s ease;">
                        üèÜ ÊéíË°åÊ¶ú
                    </button>
                </div>
                <div class="profile-actions" style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn btn-primary" onclick="closeProfileModal()" style="padding: 10px 20px;">ÂÖ≥Èó≠</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ËßÜÈ¢ëÊí≠ÊîæÊ®°ÊÄÅÊ°Ü -->
    <div id="videoModal" class="video-modal">
        <div class="video-modal-content">
            <div class="video-modal-header">
                <h3 class="video-modal-title" id="videoModalTitle">ËßÜÈ¢ëÈ¢ÑËßà</h3>
                <button class="video-modal-close" onclick="closeVideoModal()">&times;</button>
            </div>
            <div class="video-modal-body">
                <div class="video-placeholder">
                    <div class="video-placeholder-icon">üé¨</div>
                    <div>ËßÜÈ¢ëÈ¢ÑËßàÂäüËÉΩ</div>
                    <div style="font-size: 0.9rem; margin-top: 10px; opacity: 0.8;">
                        Áî±‰∫éËøôÊòØÊºîÁ§∫ÁâàÊú¨ÔºåÊöÇÊó∂Êó†Ê≥ïÊí≠ÊîæÂÆûÈôÖËßÜÈ¢ëÊñá‰ª∂
                    </div>
                </div>
                <div class="video-info">
                    <h4 id="videoFileName">ËßÜÈ¢ëÊñá‰ª∂Âêç</h4>
                    <p><strong>ÊâÄÂ±ûÁêÉÂ±Ä:</strong> <span id="videoGameTitle"></span></p>
                    <p><strong>ÁªÑÁªáËÄÖ:</strong> <span id="videoOrganizerName"></span></p>
                    <p><strong>Ê∞¥Âπ≥Á≠âÁ∫ß:</strong> <span id="videoGameLevel"></span></p>
                    <p style="color: #666; font-size: 0.9rem; margin-top: 10px;">
                        üí° ÊèêÁ§∫ÔºöÂú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåËøôÈáå‰ºöÊòæÁ§∫ËßÜÈ¢ëÊí≠ÊîæÂô®ÔºåÊîØÊåÅÂú®Á∫øËßÇÁúãÊâìÁêÉËßÜÈ¢ë
                    </p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>